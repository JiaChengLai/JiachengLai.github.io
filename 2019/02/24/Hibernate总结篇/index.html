<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="Zh-Hans">
<head>
  <meta charset="UTF-8"/>

<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误');
                history.back();
            }
        }
    })();
</script>

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hibernate," />










<meta name="description" content="什么是HibernateHibernate是一个开源的ORM（Object Relational Mapping，对象关系映射）框架，对JDBC进行了轻量级的封装，也就说Hibernate最终还是通过JDBC进行数据库的操作。它将POJO（Plain Ordinary Java Object）与数据库建立映射关系，是一个全自动的ORM框架，它可以自动生成SQL语句，自动执行，使程序员可以用面向对象">
<meta name="keywords" content="Hibernate">
<meta property="og:type" content="article">
<meta property="og:title" content="Hibernate总结篇">
<meta property="og:url" content="http://yoursite.com/2019/02/24/Hibernate总结篇/index.html">
<meta property="og:site_name" content="晨">
<meta property="og:description" content="什么是HibernateHibernate是一个开源的ORM（Object Relational Mapping，对象关系映射）框架，对JDBC进行了轻量级的封装，也就说Hibernate最终还是通过JDBC进行数据库的操作。它将POJO（Plain Ordinary Java Object）与数据库建立映射关系，是一个全自动的ORM框架，它可以自动生成SQL语句，自动执行，使程序员可以用面向对象">
<meta property="og:locale" content="Zh-Hans">
<meta property="og:image" content="https://hexoblog-1257009793.cos.ap-shanghai.myqcloud.com/19-3-6%20Hibernate%E6%80%BB%E7%BB%93%E7%AF%87/Hibernate%E4%B8%89%E7%A7%8D%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2.png">
<meta property="og:image" content="https://hexoblog-1257009793.cos.ap-shanghai.myqcloud.com/19-3-6%20Hibernate%E6%80%BB%E7%BB%93%E7%AF%87/%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98.png">
<meta property="og:image" content="https://hexoblog-1257009793.cos.ap-shanghai.myqcloud.com/19-3-6%20Hibernate%E6%80%BB%E7%BB%93%E7%AF%87/%E5%BF%AB%E7%85%A7%E5%8C%BA.png">
<meta property="og:image" content="https://hexoblog-1257009793.cos.ap-shanghai.myqcloud.com/19-3-6%20Hibernate%E6%80%BB%E7%BB%93%E7%AF%87/%E5%8E%9F%E7%94%9FSQL%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2.png">
<meta property="og:updated_time" content="2019-03-07T15:32:06.560Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hibernate总结篇">
<meta name="twitter:description" content="什么是HibernateHibernate是一个开源的ORM（Object Relational Mapping，对象关系映射）框架，对JDBC进行了轻量级的封装，也就说Hibernate最终还是通过JDBC进行数据库的操作。它将POJO（Plain Ordinary Java Object）与数据库建立映射关系，是一个全自动的ORM框架，它可以自动生成SQL语句，自动执行，使程序员可以用面向对象">
<meta name="twitter:image" content="https://hexoblog-1257009793.cos.ap-shanghai.myqcloud.com/19-3-6%20Hibernate%E6%80%BB%E7%BB%93%E7%AF%87/Hibernate%E4%B8%89%E7%A7%8D%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/02/24/Hibernate总结篇/"/>





  <title>Hibernate总结篇 | 晨</title>
  








</head>

<!--卖萌-->
<script type="text/javascript" src="/js/src/mytitle.js"></script>

<body itemscope itemtype="http://schema.org/WebPage" lang="Zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">晨</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学无止境</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/24/Hibernate总结篇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiachengLai">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="晨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Hibernate总结篇</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-24T10:34:14+08:00">
                2019-02-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaEE/" itemprop="url" rel="index">
                    <span itemprop="name">JavaEE</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="什么是Hibernate"><a href="#什么是Hibernate" class="headerlink" title="什么是Hibernate"></a>什么是Hibernate</h2><p>Hibernate是一个开源的ORM（<code>Object Relational Mapping</code>，对象关系映射）框架，对JDBC进行了轻量级的封装，也就说Hibernate最终还是通过JDBC进行数据库的操作。它将POJO（<code>Plain Ordinary Java Object</code>）与数据库建立映射关系，是一个全自动的ORM框架，它可以自动生成SQL语句，自动执行，使程序员可以用<strong>面向对象编程思想</strong>来操纵数据库。</p>
<h2 id="Hibernate的优点"><a href="#Hibernate的优点" class="headerlink" title="Hibernate的优点"></a>Hibernate的优点</h2><ul>
<li>对JDBC操作数据库的代码进行了轻量级封装，简化了操作数据库的繁琐重复性代码，减少了内存消耗，加快了运行效率。</li>
<li>将对数据库的操作转换为对Java对象的操作，从而简化开发。通过修改一个“持久化”对象的属性从而修改数据库表中对应的记录数据。</li>
<li>提供线程和进程两个级别的缓存提升应用程序性能。</li>
<li>有丰富的映射方式，可将Java对象之间的关系转换为数据库表之间的关系。</li>
<li>屏蔽不同数据库实现之间的差异。在Hibernate中只需要通过“方言”的形式指定当前使用的数据库，就可以根据底层数据库的实际情况生成适合的SQL语句。</li>
<li>非侵入式：Hibernate不要求持久化类实现任何接口或继承任何类，POJO即可。</li>
</ul>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><h3 id="JAR包导入"><a href="#JAR包导入" class="headerlink" title="JAR包导入"></a>JAR包导入</h3><p>JAR包的导入基于<code>hibernate-release-5.0.7.Final</code></p>
<table>
<thead>
<tr>
<th style="text-align:left">JAR包</th>
<th style="text-align:left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>antlr-2.7.7</code></td>
<td style="text-align:left">语言转换器，Hibernate用其实现HQL到SQL的转换</td>
</tr>
<tr>
<td style="text-align:left"><code>dom4j-1.6.1</code></td>
<td style="text-align:left">Dom4j XML解析器</td>
</tr>
<tr>
<td style="text-align:left"><code>geronimo-jta_1.1_spec-1.1.1</code></td>
<td style="text-align:left">事务相关，JTA（<code>Java Transaction API</code>）</td>
</tr>
<tr>
<td style="text-align:left"><code>jandex-2.0.0.Final</code></td>
<td style="text-align:left">Jandex在编译时刻扫描代码中annotation，并将index存储于文件中</td>
</tr>
<tr>
<td style="text-align:left"><code>javassist-3.18.1-GA</code></td>
<td style="text-align:left">代码生成工具，Hibernate用它在运行时拓展Java类</td>
</tr>
<tr>
<td style="text-align:left"><code>jboss-logging-3.3.0.Final</code></td>
<td style="text-align:left">日志相关</td>
</tr>
<tr>
<td style="text-align:left"><code>hibernate-commons-annotations-5.0.1.Final</code></td>
<td style="text-align:left">Hibernate注解相关</td>
</tr>
<tr>
<td style="text-align:left"><code>hibernate-core-5.0.7.Final</code></td>
<td style="text-align:left">Hibernate核心包</td>
</tr>
<tr>
<td style="text-align:left"><code>hibernate-jpa-2.1-api-1.0.0.Final</code></td>
<td style="text-align:left">Hibernate的Java持久层API，JPA（<code>Java Persistence API</code>）</td>
</tr>
<tr>
<td style="text-align:left"><code>mysql-connector-java-8.0.15</code></td>
<td style="text-align:left">MySQL驱动包,连接驱动版本匹配本地MySQL版本</td>
</tr>
<tr>
<td style="text-align:left"><code>log4j-1.2.16</code></td>
<td style="text-align:left">日志记录</td>
</tr>
<tr>
<td style="text-align:left"><code>slf4j-api-1.6.1</code></td>
<td style="text-align:left">日志记录</td>
</tr>
<tr>
<td style="text-align:left"><code>slf4j-log4j12-1.7.2</code></td>
<td style="text-align:left">日志记录</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<h3 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h3><h4 id="准备customer表"><a href="#准备customer表" class="headerlink" title="准备customer表"></a>准备customer表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> customer (</span><br><span class="line">	cust_id <span class="built_in">BIGINT</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment <span class="keyword">COMMENT</span> <span class="string">'客户编号'</span>,</span><br><span class="line">	cust_name <span class="built_in">VARCHAR</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户名称'</span>,</span><br><span class="line">	cust_source <span class="built_in">VARCHAR</span> ( <span class="number">32</span> ) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户来源'</span>,</span><br><span class="line">	cust_industry <span class="built_in">VARCHAR</span> ( <span class="number">32</span> ) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户行业'</span>,</span><br><span class="line">	cust_level <span class="built_in">VARCHAR</span> ( <span class="number">32</span> ) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户级别'</span>,</span><br><span class="line">	cust_linkman <span class="built_in">VARCHAR</span> ( <span class="number">64</span> ) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户联系人'</span>,</span><br><span class="line">	cust_phone <span class="built_in">VARCHAR</span> ( <span class="number">64</span> ) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户固定电话'</span>,</span><br><span class="line">	cust_mobile <span class="built_in">VARCHAR</span> ( <span class="number">16</span> ) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户移动电话'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> ( cust_id ) </span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> auto_increment = <span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8</span><br></pre></td></tr></table></figure>
<h4 id="准备Customer实体"><a href="#准备Customer实体" class="headerlink" title="准备Customer实体"></a>准备Customer实体</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> priv.jc.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long cust_id;</span><br><span class="line">	<span class="keyword">private</span> String cust_name;</span><br><span class="line">	<span class="keyword">private</span> String cust_source;</span><br><span class="line">	<span class="keyword">private</span> String cust_industry;</span><br><span class="line">	<span class="keyword">private</span> String cust_level;</span><br><span class="line">	<span class="keyword">private</span> String cust_linkman;</span><br><span class="line">	<span class="keyword">private</span> String cust_phone;</span><br><span class="line">	<span class="keyword">private</span> String cust_mobile;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getCust_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cust_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_id</span><span class="params">(Long cust_id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cust_id = cust_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCust_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cust_name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_name</span><span class="params">(String cust_name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cust_name = cust_name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCust_source</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cust_source;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_source</span><span class="params">(String cust_source)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cust_source = cust_source;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCust_industry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cust_industry;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_industry</span><span class="params">(String cust_industry)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cust_industry = cust_industry;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCust_level</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cust_level;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_level</span><span class="params">(String cust_level)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cust_level = cust_level;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCust_linkman</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cust_linkman;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_linkman</span><span class="params">(String cust_linkman)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cust_linkman = cust_linkman;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCust_phone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cust_phone;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_phone</span><span class="params">(String cust_phone)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cust_phone = cust_phone;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCust_mobile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cust_mobile;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_mobile</span><span class="params">(String cust_mobile)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cust_mobile = cust_mobile;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Customer&#123;"</span> +</span><br><span class="line">				<span class="string">"cust_id="</span> + cust_id +</span><br><span class="line">				<span class="string">", cust_name='"</span> + cust_name + <span class="string">'\''</span> +</span><br><span class="line">				<span class="string">", cust_source='"</span> + cust_source + <span class="string">'\''</span> +</span><br><span class="line">				<span class="string">", cust_industry='"</span> + cust_industry + <span class="string">'\''</span> +</span><br><span class="line">				<span class="string">", cust_level='"</span> + cust_level + <span class="string">'\''</span> +</span><br><span class="line">				<span class="string">", cust_linkman='"</span> + cust_linkman + <span class="string">'\''</span> +</span><br><span class="line">				<span class="string">", cust_phone='"</span> + cust_phone + <span class="string">'\''</span> +</span><br><span class="line">				<span class="string">", cust_mobile='"</span> + cust_mobile + <span class="string">'\''</span> +</span><br><span class="line">				<span class="string">'&#125;'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="书写ORM元数据"><a href="#书写ORM元数据" class="headerlink" title="书写ORM元数据"></a>书写ORM元数据</h3><p>在实体类 Customer 所在的包中，创建一个名称为<code>Customer.hbm.xml</code>的映射文件，在该文件中定义了实体类 Customer 的属性是如何映射到 customer表的列上的<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">		"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">		"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置表与实体对象的关系 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- package属性:填写一个包名.在元素内部凡是需要书写完整类名的属性,可以直接写简写类名. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"priv.jc.entity"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	class元素: 配置实体与表的对应关系的</span></span><br><span class="line"><span class="comment">	name: 完整类名</span></span><br><span class="line"><span class="comment">	table:数据库表名</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--上面填写了package属性 故简写类名--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--&lt;class name="priv.jc.entity.Customer" table="customer"&gt;--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Customer"</span> <span class="attr">table</span>=<span class="string">"customer"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		id元素:配置主键映射的属性 / property元素:除id之外的普通属性映射</span></span><br><span class="line"><span class="comment">		name: 填写主键对应属性名</span></span><br><span class="line"><span class="comment">		column(可选): 填写表中的主键列名.默认值:列名会默认使用属性名</span></span><br><span class="line"><span class="comment">		type(可选):填写列(属性)的类型.hibernate会自动检测实体的属性类型.</span></span><br><span class="line"><span class="comment">				每个类型有三种填法: java类型|hibernate类型|数据库类型</span></span><br><span class="line"><span class="comment">		not-null(可选):配置该属性(列)是否不能为空. 默认值:false</span></span><br><span class="line"><span class="comment">		length(可选):配置数据库中列的长度. 默认值:使用数据库类型的最大长度</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 主键生成策略 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_level"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_linkman"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="创建-Hibernate-的核心配置文件"><a href="#创建-Hibernate-的核心配置文件" class="headerlink" title="创建 Hibernate 的核心配置文件"></a>创建 Hibernate 的核心配置文件</h3><p>Hibernate的配置文件，包含了连接持久层与映射文件所需的基本信息，其配置文件有两种格式，具体如下：</p>
<ul>
<li>properties属性文件格式的配置文件，它使用键值对的形式存放信息，默认文件名称为<code>hibernate.properties</code></li>
<li>XML格式的配置文件，XML配置文件的默认名称为<code>hibernate.cfg.xml</code></li>
</ul>
<p>上述两种格式的配置文件是等价的，具体使用哪个可以自由选择。XML格式的配置文件更易于修改，配置能力更强，当改变底层应用配置时不需要改变和重新编译代码，只修改配置文件的相应属性即可，而properties格式的文件则不具有此优势，因此，在实际开发项目中，大多数情况会使用XML格式的配置文件。hibemate.cfg.xml配置文件一般在开发时会放置在src的源文件夹下，发布后，该文件会在项目的WEB-INF/classes路径下。</p>
<p>Hibernate的映射文件反映了持久化类和数据库表的映射信总，而Hibernate的配置文件则主要用来配置数据库连接以及Hibernate运行时所需要的各个属性的值。在项目的src下创建一个名称为<code>hibernate.cfg.xml</code>的文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">		"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">		"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">			#hibernate.dialect org.hibernate.dialect.MySQLDialect</span></span><br><span class="line"><span class="comment">			#hibernate.dialect org.hibernate.dialect.MySQL5Dialect</span></span><br><span class="line"><span class="comment">			#hibernate.dialect org.hibernate.dialect.MySQLInnoDBDialect</span></span><br><span class="line"><span class="comment">			#hibernate.dialect org.hibernate.dialect.MySQLMyISAMDialect</span></span><br><span class="line"><span class="comment">			#hibernate.connection.driver_class com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">			#hibernate.connection.url jdbc:mysql:///test</span></span><br><span class="line"><span class="comment">			#hibernate.connection.username gavin</span></span><br><span class="line"><span class="comment">			#hibernate.connection.password</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--MySQL8.0以上驱动换了 从com.mysql.jdbc.Driver 变成 com.mysql.cj.jdbc.Driver--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--MySQL8.0以上 需要设置时区 不需要建立SSL连接--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--以下语句会报错 Unescaped &amp; or nonterminated character/entity reference 将“&amp;”当成了特殊符号--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--&lt;property name="hibernate.connection.url"&gt;jdbc:mysql:///hibernate_test?serverTimezone=UTC&amp;characterEncoding=utf8&amp;useSSL=false&lt;/property&gt;--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql:///hibernate_test?serverTimezone=UTC&amp;amp;characterEncoding=utf8&amp;amp;useSSL=false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 数据库方言</span></span><br><span class="line"><span class="comment">		不同的数据库中,sql语法略有区别. 指定方言可以让hibernate框架在生成sql语句时.针对数据库的方言生成.</span></span><br><span class="line"><span class="comment">		sql99标准: DDL 定义语言  库表的增删改查</span></span><br><span class="line"><span class="comment">				  DCL 控制语言  事务 权限</span></span><br><span class="line"><span class="comment">				  DML 操纵语言  增删改查</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQL5Dialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- 将hibernate生成的sql语句打印到控制台 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 将hibernate生成的sql语句格式化(语法缩进) --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		## auto schema export  自动导出表结构. 自动建表</span></span><br><span class="line"><span class="comment">		#hibernate.hbm2ddl.auto create		自动建表.每次框架运行都会创建新的表.以前表将会被覆盖,表数据会丢失.(开发环境中测试使用)</span></span><br><span class="line"><span class="comment">		#hibernate.hbm2ddl.auto create-drop 自动建表.每次框架运行结束都会将所有表删除.(开发环境中测试使用)</span></span><br><span class="line"><span class="comment">		#hibernate.hbm2ddl.auto update(推荐使用) 自动生成表.如果已经存在不会再生成.如果表有变动.自动更新表(不会删除任何数据).</span></span><br><span class="line"><span class="comment">		#hibernate.hbm2ddl.auto validate	校验.不自动生成表.每次启动会校验数据库中表是否正确.校验失败.</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- 引入orm元数据</span></span><br><span class="line"><span class="comment">			路径书写: 填写src下的路径</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"priv/jc/entity/Customer.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="入门Demo"><a href="#入门Demo" class="headerlink" title="入门Demo"></a>入门Demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> priv.jc.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> priv.jc.entity.Customer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SessionFactory sessionFactory;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="comment">// 加载配置文件,调用空参构造，默认加载src下的hibernate.cfg.xml文件</span></span><br><span class="line">		Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">// 加载ORM元数据(若在hibernate.cfg.xml中没有配置ORM元数据 可在代码中配置)</span></span><br><span class="line">		<span class="comment">// configuration.addResource("priv/jc/entity/Customer.hbm.xml");</span></span><br><span class="line">		<span class="comment">// configuration.addClass(Customer.class);</span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		根据配置信息，创建sessionFactory，用来创建Session</span></span><br><span class="line"><span class="comment">		 1.SessionFactory负责保存和使用所有配置信息 消耗内存资源巨大 所以要保证web项目中只有一个sessionFactory</span></span><br><span class="line"><span class="comment">		 2.SessionFactory是线程安全对象</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		sessionFactory = configuration.buildSessionFactory();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = <span class="keyword">this</span>.getSession();</span><br><span class="line">		Transaction transaction = <span class="keyword">this</span>.getTransaction(session);</span><br><span class="line">		Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">		customer.setCust_name(<span class="string">"小明"</span>);</span><br><span class="line">		customer.setCust_source(<span class="string">"网络"</span>);</span><br><span class="line">		customer.setCust_industry(<span class="string">"计算机"</span>);</span><br><span class="line">		customer.setCust_level(<span class="string">"1"</span>);</span><br><span class="line">		customer.setCust_linkman(<span class="string">"小王"</span>);</span><br><span class="line">		customer.setCust_phone(<span class="string">"10086"</span>);</span><br><span class="line">		customer.setCust_mobile(<span class="string">"123456"</span>);</span><br><span class="line">		session.save(customer);</span><br><span class="line">		<span class="keyword">this</span>.commit(session, transaction);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = <span class="keyword">this</span>.getSession();</span><br><span class="line">		Transaction transaction = <span class="keyword">this</span>.getTransaction(session);</span><br><span class="line">		<span class="comment">// 获得要删除的对象</span></span><br><span class="line">		Customer customer = session.get(Customer.class, <span class="number">1L</span>);</span><br><span class="line">		session.delete(customer);</span><br><span class="line">		<span class="keyword">this</span>.commit(session, transaction);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = <span class="keyword">this</span>.getSession();</span><br><span class="line">		Transaction transaction = <span class="keyword">this</span>.getTransaction(session);</span><br><span class="line">		<span class="comment">// 获得要修改的对象</span></span><br><span class="line">		Customer customer = session.get(Customer.class, <span class="number">2L</span>);</span><br><span class="line">		customer.setCust_name(<span class="string">"小张"</span>);</span><br><span class="line">		session.update(customer);</span><br><span class="line">		<span class="keyword">this</span>.commit(session, transaction);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = <span class="keyword">this</span>.getSession();</span><br><span class="line">		Customer customer = session.get(Customer.class, <span class="number">2L</span>);</span><br><span class="line">		System.out.println(customer);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Session <span class="title">getSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 创建 Session 对象 Session 对象类似 Connection.</span></span><br><span class="line">		<span class="keyword">return</span> sessionFactory.openSession();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Transaction <span class="title">getTransaction</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 开启事务</span></span><br><span class="line">		<span class="comment">/*Transaction transaction = session.getTransaction();</span></span><br><span class="line"><span class="comment">		transaction.begin();*/</span></span><br><span class="line">		<span class="keyword">return</span> session.beginTransaction();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">(Session session, Transaction transaction)</span> </span>&#123;</span><br><span class="line">		transaction.commit();</span><br><span class="line">		<span class="comment">// 释放资源</span></span><br><span class="line">		session.clear();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="核心接口解析"><a href="#核心接口解析" class="headerlink" title="核心接口解析"></a>核心接口解析</h2><h3 id="SessionFactory：Session工厂对象"><a href="#SessionFactory：Session工厂对象" class="headerlink" title="SessionFactory：Session工厂对象"></a>SessionFactory：Session工厂对象</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>SessionFactory接口负责Hibernate的初始化和建立Session对象。它在Hibernate中起到一个缓冲区作用，Hibernate可以将自动生成的SQL语句、映射数据以及某些可重复利用的的数据放在这个缓冲区中。同时它还保存了对数据库配置的所有映射关系，维护了当前的二级缓存。SessionFactory实例是通过Configuration对象获取的，其获取方法如下所示。</p>
<p><code>SessionFactorySessionFactory=new Configuration().configure().buildSessionFactory();</code></p>
<p>SessionFactory具有以下特点：</p>
<ul>
<li>线程安全，它的同一个实例能够供多个线程共享。</li>
<li>重量级，不能随意的创建和销毁它的实例。</li>
</ul>
<p>由于SessionFactory的这些特点，一般情况下，一个项目中只需要一个SessionFactory,只有当应用中存在多个数据源时，才为每个数据源建立一个SessionFactory实例。</p>
<h4 id="第三方连接池的配置与使用"><a href="#第三方连接池的配置与使用" class="headerlink" title="第三方连接池的配置与使用"></a>第三方连接池的配置与使用</h4><p>SessionFactory 内部还维护了一个连接池，如果我们需要使用第三方的连接池如C3P0,那么需要我们自己手动进行配置</p>
<p><strong>配置C3P0内容如下</strong><br>引入jar包</p>
<ul>
<li>c3p0-0.9.2,1.jar</li>
<li>hibernate-c3p0-5.0.7.Final.jar</li>
<li>mchange-commons-java-0.2.3.4.jar</li>
</ul>
<p>在<code>hibernate.cfg.xml</code>中配置 C3P0 连接池<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.provider—class"</span>&gt;</span>org.hibernate.connection.C3P0ConnectionProvider<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--在连接池中可用的数据库连接的最少数目--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.min_size"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--在连接池中所有数据库连接的最大数目--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.max_size"</span>&gt;</span>20<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--设定数据库连接的过期时间，以秒为单位，</span></span><br><span class="line"><span class="comment">如果连接池中的某个数据库连接处于空闲状态的时间超过了 timeout 时间，就会从连接池中清除 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.timeout"</span>&gt;</span>120<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--每 3000 秒检查所有连接池中的空闲连接以秒为单位--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.idle_test_period"</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>Session是应用程序与数据库之间交互操作的一个单线程对象，是Hibernate运作的中心，它的主要功能是为持久化对象提供创建、读取和删除的能力，所有持久化对象必须在Session的管理下才可以进行持久化操作。创建SessionFactory实例后，就可以通过它获取Session实例。<br>获取Session实例有两种方式，一种是通过openSession()方法，另一种是通过getCurrentSession()方法。两种方法获取session的代码如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 采用openSession方法创建</span></span><br><span class="line"><span class="comment">// 采用openSession方法获取Session实例时，SessionFactory直接创建一个新的Session实例，并且在使用完成后需要调用close方法进行手动关闭</span></span><br><span class="line">sessionSessionsession=SessionFactory.openSession();</span><br><span class="line"><span class="comment">// 采用getCurrentSession()方法创建session</span></span><br><span class="line"><span class="comment">// getCurrentSession方法创建的Session实例会被绑定到当前线程中，它在提交或回滚操作时会自动关闭</span></span><br><span class="line">Sessionsession=sessionFactory.getCurrentSession();</span><br></pre></td></tr></table></figure></p>
<p>以上两种获取sessionSession是线程不安全的，多个并发线程同时操作一个Session实例时，就可能导致Session数据存取的混乱（方法内部定义和使用Session时，不会出现线程问题）。因此设计软件架构时，应避免多个线程共享一个Session实例。同时它也是轻量级的，实例的创建和销毁不需要消耗太多的资源。它还有一个缓存，即Hibernate的一级缓存，这个缓存主要用于存放当前工作单元加载的对象。在Session中提供了大量的常用方法，具体如下：</p>
<ul>
<li>save()、update()和saveOrUpdate()方法：用于增加和修改对象。</li>
<li>delete()方法：用于删除对象。</li>
<li>get()和load()方法：根据主键查询。</li>
<li>createQuery()和createSQLQuery()方法：用于数据库操作对象。</li>
<li>createCriteria()方法：条件查询。</li>
</ul>
<h3 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h3><p>Transaction接口主要用于管理事务，它是Hibernate的数据库事务接口，且对底层的事务接口进行了封装。Transaction接口的事务对象是通过Session对象开启的，其幵启方式如下所示。<code>Transaction transaction=session.beginTransaction();</code><br>在Transaction接口中，提供了事务管理的常用方法：</p>
<ul>
<li>commit()方法：提交相关联的Session实例</li>
<li>rollback()方法：撤销事务操作</li>
</ul>
<p>Session执行完数据库操作后，要使用Transaction接口的commit()方法进行事务提交，才能真正的将数据操作同步到数据库中。发生异常时，需要使用rollback()方法进行事务回滚，以避免数据发生错误。因此，在持久化操作后，必须调用Transaction接口的commit()方法和rollback()方法。如果没有开启事务，那么每个Session的操作，都相当于一个独立的操作。</p>
<h2 id="Hibernate实体类创建注意事项"><a href="#Hibernate实体类创建注意事项" class="headerlink" title="Hibernate实体类创建注意事项"></a>Hibernate实体类创建注意事项</h2><ul>
<li>持久化类提供无参数构造。Hibernate的底层需要使用反射生成类的实例。</li>
<li>持久化类的属性需要私有，对私有的属性提供公有的get和set方法。因为在Hibernate底层会将查询到的数据进行封装。</li>
<li>持久化类中的属性，应尽量使用包装类型(Long、Double、Integer、Boolean、String等)。</li>
<li>持久化类需要提供一个唯一标识OID，与数据库中的主键列对应。因为Hibernate中需要通过这个唯一标识0ID区分在内存中是否是同一个持久化类。</li>
<li>不能用final修饰class。hibernate使用cglib代理生成代理对象，代理对象继承被代理对象，如果被final修饰.将无法生成代理，从而就不会产生代理对象，那么Hibernate的延迟加载策略（优化手段）就会失效。</li>
</ul>
<h2 id="Hibernate主键生成策略"><a href="#Hibernate主键生成策略" class="headerlink" title="Hibernate主键生成策略"></a>Hibernate主键生成策略</h2><table>
<thead>
<tr>
<th style="text-align:center">主键生成策略</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>identity</code></td>
<td style="text-align:left">对long、short或int的数据主键自增.由数据库来维护主键值.录入时不需要指定主键</td>
</tr>
<tr>
<td style="text-align:center"><code>sequence</code></td>
<td style="text-align:left">Oracle中的主键生成策略</td>
</tr>
<tr>
<td style="text-align:center"><code>increment</code></td>
<td style="text-align:left">对long、short或int的数据主键自增.由hibernate来维护.每次插入前会先查询表中id最大值.+1作为新主键值.increment方式的不足之处是当多个线程并发对数据库表进行写操作时，可能出现相同的主键值，发生主键重复的冲突，因此多线程并发操作时，不应该使用此方法</td>
</tr>
<tr>
<td style="text-align:center"><code>hilo</code></td>
<td style="text-align:left">高低位算法.主键自增.由hibernate来维护.通过hi/lo 算法生成主键，需要一个表来保存额外的主键信息,需要维护表信息，因此对数据的影响的要率会造成一定影响</td>
</tr>
<tr>
<td style="text-align:center"><code>native</code></td>
<td style="text-align:left">hilo+sequence+identity自动三选一策略,与底层性无关，便于不同数据库之间的移植</td>
</tr>
<tr>
<td style="text-align:center"><code>uuid.hex</code></td>
<td style="text-align:left">采用基于128位的算法生成唯一值，并编制成32位长度的唯一字符串作为主键值，uuid.hex的优点是支持大部分数据库，缺点就是要占用较大的存储空间。对于并发Insert要求较高的系统，推荐采用uuid.hex作为主键生成机制</td>
</tr>
<tr>
<td style="text-align:center"><code>uuid.string</code></td>
<td style="text-align:left">使用UUID算法，UUID被编码为一个16个字符长的任意ASCII字符组成的字符串。不能在PostgreSQL数据库中使用。uuid.string同uuid.hex类似，需要占很大的存储空间</td>
</tr>
<tr>
<td style="text-align:center"><code>assigned</code></td>
<td style="text-align:left">自然主键生成策略. hibernate不会管理主键值.由开发人员自己录入</td>
</tr>
<tr>
<td style="text-align:center"><code>foreign</code></td>
<td style="text-align:left">使用另外一个相关联的对象的标识符作为主键</td>
</tr>
</tbody>
</table>
<h2 id="Hibernate的对象状态"><a href="#Hibernate的对象状态" class="headerlink" title="Hibernate的对象状态"></a>Hibernate的对象状态</h2><p>Hibernate中的对象存在三种状态:</p>
<table>
<thead>
<tr>
<th style="text-align:center">状态</th>
<th style="text-align:center">存在OID</th>
<th style="text-align:center">与Session关联</th>
<th style="text-align:center">在数据库有记录</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">瞬时态(transient)</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td style="text-align:center">由new创建，在内存中是孤立存在的， 与数据库中的数据无任何关联，仅是一个信息携带的载体。</td>
</tr>
<tr>
<td style="text-align:center">持久态(persistent)</td>
<td style="text-align:center">是</td>
<td style="text-align:center">是</td>
<td style="text-align:center">是</td>
<td style="text-align:center">持久态对象是在事务还未提交前变成持久态的。</td>
</tr>
<tr>
<td style="text-align:center">游离态(detached)</td>
<td style="text-align:center">是</td>
<td style="text-align:center">否</td>
<td style="text-align:center">是</td>
<td style="text-align:center">当某个持久化状态的实例与Session的关联被关闭时就变成了脱管态。</td>
</tr>
</tbody>
</table>
<p><img src="https://hexoblog-1257009793.cos.ap-shanghai.myqcloud.com/19-3-6%20Hibernate%E6%80%BB%E7%BB%93%E7%AF%87/Hibernate%E4%B8%89%E7%A7%8D%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2.png" alt=""></p>
<h2 id="Hibernate中的缓存"><a href="#Hibernate中的缓存" class="headerlink" title="Hibernate中的缓存"></a>Hibernate中的缓存</h2><h3 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>Hibernate的一级缓存就是指Session缓存，Session缓存是一块内存空间，用来存放相互管理的java对象，在使用Hibernate查询对象的时候，首先会使用对象属性的OID值在Hibernate的一级缓存中进行查找，如果找到匹配OID值的对象，就直接将该对象从一级缓存中取出使用，不会再查询数据库；如果没有找到相同OID值的对象，则会去数据库中查找相应数据。当从数据库中查询到所需数据时，该数据信息也会放置到一级缓存中。Hibernate的一级缓存的作用就是<strong>减少对数据库的访问次数</strong>。</p>
<p>在Session接口的实现中包含一系列的Java集合，这些Java集合构成了Session缓存。只要Session实例没有结束生命周期，存放在它缓存中的对象也不会结束生命周期。固一级缓存也被称为是Session基本的缓存。</p>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li>当应用程序调用Session接口的save()、update()、saveOrUpdate时，如果 Session 缓存中没有相应的对象，Hibernate就会自动的把从数据库中查询到的相应对象信息加入到一级缓存<br>中去。</li>
<li>当调用Session接口的load()、get()方法，以及Query接口的list()、iterator()方法时，会判断缓存中是否存在该对象，有则返回，不会查询数据库，如果缓存中没有要查询对象，再去数据库中查询对应对象，并添加到一级缓存中。</li>
<li>当调用Session的Close()方法时，Session缓存会被清空。</li>
</ul>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">	SessionFactory sessionFactory = configuration.buildSessionFactory();</span><br><span class="line">	Session session = sessionFactory.openSession();</span><br><span class="line">	<span class="comment">// 生成一条SQL查询 id为2的Customer，并将查询出的数据存入一级缓存</span></span><br><span class="line">	Customer customer1 = session.get(Customer.class, <span class="number">1L</span>);</span><br><span class="line">	<span class="comment">// 发现一级缓存中已存在 id为2的Customer 不通过SQL查询 直接用一级缓存中返回 所以返回的句柄与Customer1相同</span></span><br><span class="line">	Customer customer2 = session.get(Customer.class, <span class="number">1L</span>);</span><br><span class="line">	<span class="comment">// 如上所述 这里返回true 对象地址相同</span></span><br><span class="line">	System.out.println(customer1 == customer2);</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://hexoblog-1257009793.cos.ap-shanghai.myqcloud.com/19-3-6%20Hibernate%E6%80%BB%E7%BB%93%E7%AF%87/%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98.png" alt=""></p>
<h4 id="快照区"><a href="#快照区" class="headerlink" title="快照区"></a>快照区</h4><p>Hibernate向一级缓存放入数据时，同时复制一份数据放入到Hibernate快照中，当使用commit()方法提交事务时，同时会清理Session的一级缓存，这时会使用OID判断一级缓存中的对象和快照中的对象是否一致，如果两个对象中的属性发生变化，则执行update语句，将缓存的内容同步到数据库，并更新快照；如果一致，则不执行update语句。Hibernate快照的作用就是确保一级缓存中的数据和数据库中的数据一致。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">	SessionFactory sessionFactory = configuration.buildSessionFactory();</span><br><span class="line">	Session session = sessionFactory.openSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line">	<span class="comment">// 生成一条SQL查询 id为2的Customer，并将查询出的数据存入一级缓存 和 快照</span></span><br><span class="line">	<span class="comment">//Customer&#123;cust_id=2, cust_name='小张', cust_source='网络', cust_industry='计算机', cust_level='1', cust_linkman='小王', cust_phone='10086', cust_mobile='123456'&#125;</span></span><br><span class="line">	Customer customer1 = session.get(Customer.class, <span class="number">1L</span>);</span><br><span class="line">	<span class="comment">// customer1.setCust_name("小张");</span></span><br><span class="line">	<span class="comment">// customer1.setCust_industry("计算机");</span></span><br><span class="line">	<span class="comment">// 缓冲与快照中数据一致 不执行update语句</span></span><br><span class="line">	<span class="comment">// session.update(customer1);</span></span><br><span class="line">	<span class="comment">// 缓存与快照中数据不一致 且数据处于持久态 数据发生变化 自动执行update语句 将缓存中数据同步到数据库 并更新快照</span></span><br><span class="line">	customer1.setCust_name(<span class="string">"小明"</span>);</span><br><span class="line">	customer1.setCust_industry(<span class="string">"美容美发"</span>);</span><br><span class="line">	transaction.commit();</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://hexoblog-1257009793.cos.ap-shanghai.myqcloud.com/19-3-6%20Hibernate%E6%80%BB%E7%BB%93%E7%AF%87/%E5%BF%AB%E7%85%A7%E5%8C%BA.png" alt=""></p>
<h2 id="Hibernate中的事务"><a href="#Hibernate中的事务" class="headerlink" title="Hibernate中的事务"></a>Hibernate中的事务</h2><h3 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h3><p>在数据库操作中，一项事务（Transaction)是由一条或多条操作数据库的SQL语句组成的一个不可分割的工作单元。当事务中的所有操作都正常完成时，整个事务才能被提交到数据库中，如果有一项操作没有完成，则整个事务会被回滚。其实事务总结起来理解为：逻辑上的一组操作，组成这组操作的各个单元，要么一起成功，要么一起失败。</p>
<h3 id="事务的特性"><a href="#事务的特性" class="headerlink" title="事务的特性"></a>事务的特性</h3><p>事务有很严格的定义，需要同时满足四个特性，即原子性、一致性、隔离性、持久性。这四个特性通常称之为ACID特性，具体如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">事物的特性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">原子性（<code>Atomic</code>)</td>
<td style="text-align:left">表示将事务中所做的操作捆绑成一个不可分割的单元，即对事务所进行的数据修改等操作，要么全部执行，要么全都不执行。</td>
</tr>
<tr>
<td style="text-align:center">一致性（<code>Consistency</code>)</td>
<td style="text-align:left">表示事务完成时，必须使所有的数据都保持一致状态。</td>
</tr>
<tr>
<td style="text-align:center">隔离性(<code>Isolation</code>)</td>
<td style="text-align:left">指一个事务的执行不能被其它事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</td>
</tr>
<tr>
<td style="text-align:center">持久性（<code>Durability</code>)</td>
<td style="text-align:left">持久性也称永久性(permanence),指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。提交后的其他操作或故障不会对其有任何影响。</td>
</tr>
</tbody>
</table>
<h3 id="事务的并发问题"><a href="#事务的并发问题" class="headerlink" title="事务的并发问题"></a>事务的并发问题</h3><p>在实际应用过程中，数据库是要被多个用户所共同访问的。在多个事务同时使用相同的数据时,可能会发生并发的问题，具体如下。</p>
<table>
<thead>
<tr>
<th style="text-align:center">事务的并发特性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">脏读</td>
<td style="text-align:left">一个事务读取到另一个事务未提交的数据。</td>
</tr>
<tr>
<td style="text-align:center">不可重复读</td>
<td style="text-align:left">一个事务读到了另一个事务己经提交的update的数据，导致在同一个事务中的多次查询结果不一致。</td>
</tr>
<tr>
<td style="text-align:center">虚读/幻读</td>
<td style="text-align:left">一个事务读到了另一个事务已经提交的insert的数据，导致在同一个事务中的多次查询结果不一致。</td>
</tr>
</tbody>
</table>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><p>为了避免事务并发问题的发生，在标准SQL规范中，定义了4个事务隔离级别，不同的隔离级别对事务的处理不同。</p>
<table>
<thead>
<tr>
<th style="text-align:center">事务的隔离级别</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">读未提交（<code>Read Uncommitted</code>,1级）</td>
<td style="text-align:left">一个事务在执行过程中，既可以访问其他事务未提交的新插入的数据，又可以访问未提交的修改数据。如果一个事务己经开始写数据，则另外一个事务则不允许同时进行写操作，但允许其他事务读此行数据。此隔离级别可防止丢失更新。<strong>可能导致脏读、不可重复读、幻读</strong></td>
</tr>
<tr>
<td style="text-align:center">己提交读（<code>Read Committed</code>,2级）</td>
<td style="text-align:left">一个事务在执行过程中，既可以访问其他事务成功提交的新插入的数据，又可以访问成功修改的数据。读取数据的事务允许其他事务继续访问该行数据，但是未提交的写事务将会禁止其他事务访问该行。此隔离级别可有效<strong>防止脏读</strong>。</td>
</tr>
<tr>
<td style="text-align:center">可重复读（<code>Repeatable Read</code>,4级）</td>
<td style="text-align:left">一个事务在执行过程中，可以访问其他事务成功提交的新插入的数据，但不可以访问成功修改的数据。读取数据的事务将会禁止写事务（但允许读事务），写事务则禁止任何其他事务。此隔离级别可有效的<strong>防止不可重复读和脏读</strong>。</td>
</tr>
<tr>
<td style="text-align:center">序列化/串行化（<code>serializable</code>，8级）</td>
<td style="text-align:left">提供严格的事务隔离。它要求事务序列化执行，事务只能一个接着一个地执行，但不能并发执行。此隔离级别可有效的<strong>防止脏读、不可重复读和幻读</strong>。</td>
</tr>
</tbody>
</table>
<p>事务的隔离级别，是由数据库提供的，并不是所有数据库都支持四种隔离级别</p>
<table>
<thead>
<tr>
<th style="text-align:center">事务的隔离级别</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MySQL</td>
<td style="text-align:left">READ UNCOMMITTED、READ COMMITTED、REPEATABLE READ(<strong>默认</strong>)、SERIALIZABLE</td>
</tr>
<tr>
<td style="text-align:center">Oracle</td>
<td style="text-align:left">READ_UNCOMMITTED、READ_COMMITTED(<strong>默认</strong>)、SERIALIZABLE</td>
</tr>
</tbody>
</table>
<h3 id="Hibernate的事务管理"><a href="#Hibernate的事务管理" class="headerlink" title="Hibernate的事务管理"></a>Hibernate的事务管理</h3><h4 id="隔离级别的设置"><a href="#隔离级别的设置" class="headerlink" title="隔离级别的设置"></a>隔离级别的设置</h4><p>在 <code>hibernate.cfg.xml</code>中的<code>&lt;session-factory&gt;</code>标签元素中配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">事务隔离级别</span></span><br><span class="line"><span class="comment">hibernate.connection.isolation</span></span><br><span class="line"><span class="comment">1—Read uncommitted isolation</span></span><br><span class="line"><span class="comment">2—Read committed isolation</span></span><br><span class="line"><span class="comment">4—Repeatable read isolation</span></span><br><span class="line"><span class="comment">8—Serializable isolation</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.isolation"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="保证Service层开启事务的和DAO层操纵数据库Session相同"><a href="#保证Service层开启事务的和DAO层操纵数据库Session相同" class="headerlink" title="保证Service层开启事务的和DAO层操纵数据库Session相同"></a>保证Service层开启事务的和DAO层操纵数据库Session相同</h4><p>保证在 Service 中开启的事务时使用的 Session 对象和 DAO 中多个操作使用的是同一个 Session 对象有两种方法</p>
<ul>
<li>Service 层获取Session，并将Session作为参数传递给DAO</li>
<li>用ThreadLocal将Service层获取的参数绑定到当前线程中，然后再DAO获取Session的时候，都从当前线程中获取</li>
</ul>
<p>配置Session绑定方式：<br>在 <code>hibernate.cfg.xml</code>中的<code>&lt;session-factory&gt;</code>标签元素中配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">thread: Session对象的生命周期与本地线程绑定</span></span><br><span class="line"><span class="comment">jta：Session对象的声明周期与jta事务绑定</span></span><br><span class="line"><span class="comment">managed：Hibernate委托程序管理Session对象的声明周期</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="常用API"><a href="#常用API" class="headerlink" title="常用API"></a>常用API</h2><h3 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h3><p>Query 代表面向对象的一个 Hibernate 查询操作</p>
<p><strong>使用步骤:</strong></p>
<ol>
<li>获得 Hibernate 的 Session 对象。</li>
<li>编写 HQL 语句。</li>
<li>调用 session.createQuery 创建查询对象。</li>
<li>如果 HQL 语句包含参数， 则调用 Query 的 setXxx 设置参数。</li>
<li>调用 Query 对象的 list() 或 umqueResult() 方法执行查询。</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:left">方法</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">list()</td>
<td style="text-align:left">根据条件查询全部数据。</td>
</tr>
<tr>
<td style="text-align:left">setter方法</td>
<td style="text-align:left">Query 接口中提供了一系列的 setter 方法用于设置查询语句中的参数，针对不同的数据类型，需要用到不同的 setter 方法。</td>
</tr>
<tr>
<td style="text-align:left">iterator()</td>
<td style="text-align:left">该方法用于查询语句,返回的结果是一个Iterator对象，读取时只能按照顺序读取，他仅把使用到的数据转换成Java实体对象。</td>
</tr>
<tr>
<td style="text-align:left">uniqueResult()</td>
<td style="text-align:left">用于返回唯一的结果，确保只有一条记录时，可以使用该方法。</td>
</tr>
<tr>
<td style="text-align:left">executeUpdate()</td>
<td style="text-align:left">支持HQL语句的更新和删除操作。</td>
</tr>
<tr>
<td style="text-align:left">setFirstResult()</td>
<td style="text-align:left">设置开始查询的记录位置，默认从0开始计算。</td>
</tr>
<tr>
<td style="text-align:left">setMaxResult()</td>
<td style="text-align:left">设置结果集最大结果数，与setFirstResult()结合来限制结果集范围，从而实现分页。</td>
</tr>
</tbody>
</table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> priv.jc.web.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.query.Query;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> priv.jc.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> priv.jc.utils.HibernateUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HQL是Hibernate独家查询语言，属于面向对象的查询语言</span></span><br><span class="line"><span class="comment">//--&gt;多表查询，不复杂时使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HQLTest</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//HQL基本查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		String hql = <span class="string">"from Customer"</span>;</span><br><span class="line">		Query query = session.createQuery(hql);</span><br><span class="line">		<span class="comment">//有多个值则用list()</span></span><br><span class="line">		List&lt;Customer&gt; customerList = query.list();</span><br><span class="line">		System.out.println(customerList);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//HQL条件查询</span></span><br><span class="line">	<span class="comment">//?号占位符</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		<span class="comment">//用JPA占位符方式 原来用?号占位的方式已经过时</span></span><br><span class="line">		<span class="comment">//新版Hibernate中？号占位符需改成JPA占位符的方式 from Customer where cust_id=?0   其中"?"后面的"0"代表索引位置，在HQL语句中可重复出现，并不一定要从0开始，可以是任何数字，只是参数要与其对应上。</span></span><br><span class="line">		<span class="comment">//?后面跟索引index  query.setParameter(index,xxx)</span></span><br><span class="line">		String hql = <span class="string">"FROM Customer Where cust_id=?0"</span>;</span><br><span class="line">		Query query = session.createQuery(hql);</span><br><span class="line">		query.setParameter(<span class="number">0</span>, <span class="number">2l</span>);</span><br><span class="line">		<span class="comment">//由于查出来只有唯一一个值 所以用uniqueResult()</span></span><br><span class="line">		Customer customer = (Customer) query.uniqueResult();</span><br><span class="line">		System.out.println(customer);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//HQL条件查询</span></span><br><span class="line">	<span class="comment">//命名占位符</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		<span class="comment">//冒号后跟的为命名 可任意命名(不重复)</span></span><br><span class="line">		<span class="comment">//eg:cust_id=:aaa</span></span><br><span class="line">		<span class="comment">//query.serParameter("aaa",xxxx)</span></span><br><span class="line">		String hql = <span class="string">"from Customer where cust_id=:cust_id"</span>;</span><br><span class="line">		Query query = session.createQuery(hql);</span><br><span class="line">		query.setParameter(<span class="string">"cust_id"</span>, <span class="number">2l</span>);</span><br><span class="line">		<span class="comment">//由于查出来只有唯一一个值 所以用uniqueResult()</span></span><br><span class="line">		Customer customer = (Customer) query.uniqueResult();</span><br><span class="line">		System.out.println(customer);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//HQL分页查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		String hql = <span class="string">"from Customer"</span>;</span><br><span class="line">		Query query = session.createQuery(hql);</span><br><span class="line">		query.setFirstResult(<span class="number">1</span>);<span class="comment">//index 索引数</span></span><br><span class="line">		query.setMaxResults(<span class="number">2</span>);<span class="comment">//count 查询个数</span></span><br><span class="line">		List&lt;Customer&gt; customerList = query.list();</span><br><span class="line">		System.out.println(customerList);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Criteria"><a href="#Criteria" class="headerlink" title="Criteria"></a>Criteria</h3><p>Criteria是一个完全面向对象，可扩展的条件查询API,通过它完全不需要考虑数据库底层如何实现，以及SQL语句如何编写，它是Hibernate框架的核心查询对象。Criteria查询，又称为QBC查询（QueryByCriteria),它是Hibernate的另一种对象检索方式。org.hibernate.criterion.Criterion是Hibernate提供的一个面向对象查询条件接口，一个单独的查询就是Criterion接口的一个实例，用于限制Criteria对象的查询，在Hibernate中Criterion对象的创建通常是通过Restrictions工厂类完成的，它提供了条件查询方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> priv.jc.web.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Criteria;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Projections;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> priv.jc.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> priv.jc.utils.HibernateUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>:JiachengLai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>:18/5/28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Time</span>:00:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:Criteria的基本用法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Criteria 是Hibernate自创的无语句查询</span></span><br><span class="line"><span class="comment">//--&gt;单表条件查询</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CriteriaTest</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//Criteria基本查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">		List&lt;Customer&gt; customerList = criteria.list();</span><br><span class="line">		System.out.println(customerList);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//Criteria条件查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">		<span class="comment">//添加 限制参数 查询cust_id为2的Customer对象</span></span><br><span class="line">		criteria.add(Restrictions.eq(<span class="string">"cust_id"</span>, <span class="number">2l</span>));</span><br><span class="line">		Customer customer = (Customer) criteria.uniqueResult();</span><br><span class="line">		System.out.println(customer);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//Criteria总记录数查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">		<span class="comment">//设置查询的聚合函数 --&gt;总行数</span></span><br><span class="line">		criteria.setProjection(Projections.rowCount());</span><br><span class="line">		Long count = (Long) criteria.uniqueResult();</span><br><span class="line">		System.out.println(count);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="NativeQuery"><a href="#NativeQuery" class="headerlink" title="NativeQuery"></a>NativeQuery</h3><p>这个接口用于接收一个sql语句进行查询，然后调用list()或者uniqueResult()方法进行查询。但是sql语句查询出的结果不会直接封装到实体对象中，需要手动写代码才可以封装到实体中。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> priv.jc.web.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.SQLQuery;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.query.NativeQuery;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.query.Query;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.query.internal.NativeQueryImpl;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> priv.jc.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> priv.jc.utils.HibernateUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//原生SQL查询</span></span><br><span class="line"><span class="comment">//--&gt;复杂的业务查询</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//SQLQuery已经过时</span></span><br><span class="line"><span class="comment">//取而代之的是NativeQuery，但是这个NativeQuery是个接口，</span></span><br><span class="line"><span class="comment">// 而且这个接口里面的方法不能够作基本用途</span></span><br><span class="line"><span class="comment">// 所以我们要用它的实现类来做载体，NativeQueryImpl。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SQLTest</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//SQL基本查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		String sql = <span class="string">"select * from cst_customer"</span>;</span><br><span class="line">		NativeQuery&lt;Customer&gt; nativeQuery = (NativeQueryImpl&lt;Customer&gt;) session.createNativeQuery(sql);</span><br><span class="line">		nativeQuery.addEntity(Customer.class);</span><br><span class="line">		List&lt;Customer&gt; customerList = nativeQuery.list();</span><br><span class="line">		System.out.println(customerList);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//SQL条件查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		String sql = <span class="string">"select * from cst_customer where cust_id =?0"</span>;</span><br><span class="line">		NativeQuery&lt;Customer&gt; nativeQuery = (NativeQueryImpl&lt;Customer&gt;) session.createNativeQuery(sql);</span><br><span class="line">		nativeQuery.setParameter(<span class="number">0</span>, <span class="number">2l</span>);</span><br><span class="line">		nativeQuery.addEntity(Customer.class);</span><br><span class="line">		Customer customer = nativeQuery.uniqueResult();</span><br><span class="line">		System.out.println(customer);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//SQL分页查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		String sql = <span class="string">"select * from cst_customer limit ?0,?1"</span>;</span><br><span class="line">		NativeQuery&lt;Customer&gt; nativeQuery = (NativeQueryImpl&lt;Customer&gt;) session.createNativeQuery(sql);</span><br><span class="line">		nativeQuery.addEntity(Customer.class);</span><br><span class="line">		nativeQuery.setParameter(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">		nativeQuery.setParameter(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">		List&lt;Customer&gt; customerList = nativeQuery.list();</span><br><span class="line">		System.out.println(customerList);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Hibernate中的一对多关系映射并操作"><a href="#Hibernate中的一对多关系映射并操作" class="headerlink" title="Hibernate中的一对多关系映射并操作"></a>Hibernate中的一对多关系映射并操作</h2><h3 id="创建测试表"><a href="#创建测试表" class="headerlink" title="创建测试表"></a>创建测试表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> product (</span><br><span class="line">product_id <span class="built_in">BIGINT</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment <span class="keyword">COMMENT</span> <span class="string">'商品编号'</span>,</span><br><span class="line">product_name <span class="built_in">VARCHAR</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'商品名称'</span>,</span><br><span class="line">product_brand_id <span class="built_in">BIGINT</span> ( <span class="number">32</span> ) <span class="keyword">COMMENT</span> <span class="string">'对应品牌编号'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> ( product_id ) </span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> auto_increment = <span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8 </span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> brand (</span><br><span class="line">brand_id <span class="built_in">BIGINT</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment <span class="keyword">COMMENT</span> <span class="string">'品牌编号'</span>,</span><br><span class="line">brand_name <span class="built_in">VARCHAR</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'品牌名称'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> ( brand_id ) </span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> auto_increment = <span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8 </span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> product <span class="keyword">ADD</span> FOREIGN <span class="keyword">KEY</span> (product_brand_id) <span class="keyword">REFERENCES</span> brand(brand_id)</span><br></pre></td></tr></table></figure>
<h3 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h3><p><strong>Product.java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> priv.jc.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long product_id;</span><br><span class="line">	<span class="keyword">private</span> String product_name;</span><br><span class="line">	<span class="keyword">private</span> Brand brand;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getProduct_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> product_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct_id</span><span class="params">(Long product_id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.product_id = product_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getProduct_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> product_name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct_name</span><span class="params">(String product_name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.product_name = product_name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Brand <span class="title">getBrand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> brand;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBrand</span><span class="params">(Brand brand)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.brand = brand;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Brand.java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> priv.jc.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Brand</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long brand_id;</span><br><span class="line">	<span class="keyword">private</span> String brand_name;</span><br><span class="line">	<span class="keyword">private</span> Set&lt;Product&gt; productSet = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getBrand_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> brand_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBrand_id</span><span class="params">(Long brand_id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.brand_id = brand_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getBrand_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> brand_name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBrand_name</span><span class="params">(String brand_name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.brand_name = brand_name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Set&lt;Product&gt; <span class="title">getProductSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> productSet;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductSet</span><span class="params">(Set&lt;Product&gt; productSet)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.productSet = productSet;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="书写ORM元数据-1"><a href="#书写ORM元数据-1" class="headerlink" title="书写ORM元数据"></a>书写ORM元数据</h3><p><strong>Product.hbm.xml</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">		"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">		"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"priv.jc.entity"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Product"</span> <span class="attr">table</span>=<span class="string">"product"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"product_id"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"product_name"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--配置关联对象:--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--many-to-one:多对一标签 name引用属性名 class引用的对象完整列名 column外键列名--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"brand"</span> <span class="attr">class</span>=<span class="string">"Brand"</span> <span class="attr">column</span>=<span class="string">"product_brand_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Brand.hbm.xml</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">		"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">		"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"priv.jc.entity"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Brand"</span> <span class="attr">table</span>=<span class="string">"brand"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"brand_id"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brand_name"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--配置关联对象--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--set标签 name集合的属性名称--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"productSet"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--key标签 column外键列名--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"product_brand_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--one-to-many标签 class集合中对象的完整类名--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"Product"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-many</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="配置文件中加载映射"><a href="#配置文件中加载映射" class="headerlink" title="配置文件中加载映射"></a>配置文件中加载映射</h3><p>hibernate.cfg.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"priv/jc/entity/Brand.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"priv/jc/entity/Product.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="测试demo"><a href="#测试demo" class="headerlink" title="测试demo"></a>测试demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> priv.jc.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> priv.jc.entity.Brand;</span><br><span class="line"><span class="keyword">import</span> priv.jc.entity.Product;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass1</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SessionFactory sessionFactory;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="comment">// 加载配置文件,调用空参构造，默认加载src下的hibernate.cfg.xml文件</span></span><br><span class="line">		Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">// 加载ORM元数据(若在hibernate.cfg.xml中没有配置ORM元数据 可在代码中配置)</span></span><br><span class="line">		<span class="comment">// configuration.addResource("priv/jc/entity/Customer.hbm.xml");</span></span><br><span class="line">		<span class="comment">// configuration.addClass(Customer.class);</span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		根据配置信息，创建sessionFactory，用来创建Session</span></span><br><span class="line"><span class="comment">		 1.SessionFactory负责保存和使用所有配置信息 消耗内存资源巨大 所以要保证web项目中只有一个sessionFactory</span></span><br><span class="line"><span class="comment">		 2.SessionFactory是线程安全对象</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		sessionFactory = configuration.buildSessionFactory();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = sessionFactory.getCurrentSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">		Brand brand = <span class="keyword">new</span> Brand();</span><br><span class="line">		brand.setBrand_name(<span class="string">"美特斯邦威"</span>);</span><br><span class="line"></span><br><span class="line">		Product product1 = <span class="keyword">new</span> Product();</span><br><span class="line">		product1.setProduct_name(<span class="string">"衬衫"</span>);</span><br><span class="line">		Product product2 = <span class="keyword">new</span> Product();</span><br><span class="line">		product2.setProduct_name(<span class="string">"T恤"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 建立关系</span></span><br><span class="line">		brand.getProductSet().add(product1);</span><br><span class="line">		brand.getProductSet().add(product2);</span><br><span class="line">		product1.setBrand(brand);</span><br><span class="line">		product2.setBrand(brand);</span><br><span class="line"></span><br><span class="line">		session.save(brand);</span><br><span class="line">		session.save(product1);</span><br><span class="line">		session.save(product2);</span><br><span class="line"></span><br><span class="line">		transaction.commit();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="级联操作"><a href="#级联操作" class="headerlink" title="级联操作"></a>级联操作</h2><p>级联操作是指当主控方执行保存、更新或者删除操作时，其关联对象（被控方）也执行相同的操作。在映射文件中通过对cascade属性的设置来控制是否对关联对象采用级联操作，级联操作对各种关联关系都是有效的。</p>
<p>级联是有方向性的，以一对多关系为例，<strong>一</strong>的一方级联<strong>多</strong>的一方,<strong>多</strong>的一方级联<strong>一</strong>的一方。</p>
<h3 id="级联保存"><a href="#级联保存" class="headerlink" title="级联保存"></a>级联保存</h3><h4 id="Brand级联Product"><a href="#Brand级联Product" class="headerlink" title="Brand级联Product"></a>Brand级联Product</h4><p>brand.cfg.xml中<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置关联对象--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--set标签 name集合的属性名称--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">级联操作:cascade</span></span><br><span class="line"><span class="comment">	 save-update 级联保存更新</span></span><br><span class="line"><span class="comment">	 delete  级联删除</span></span><br><span class="line"><span class="comment">	 all save-update+delete</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"productSet"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--key标签 column外键列名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"product_brand_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--one-to-many标签 class集合中对象的完整类名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"Product"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-many</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   Session session = sessionFactory.getCurrentSession();</span><br><span class="line">   Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">   Brand brand = <span class="keyword">new</span> Brand();</span><br><span class="line">   brand.setBrand_name(<span class="string">"美特斯邦威"</span>);</span><br><span class="line"></span><br><span class="line">   Product product1 = <span class="keyword">new</span> Product();</span><br><span class="line">   product1.setProduct_name(<span class="string">"衬衫"</span>);</span><br><span class="line">   Product product2 = <span class="keyword">new</span> Product();</span><br><span class="line">   product2.setProduct_name(<span class="string">"T恤"</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 建立关系</span></span><br><span class="line">   brand.getProductSet().add(product1);</span><br><span class="line">   brand.getProductSet().add(product2);</span><br><span class="line">   product1.setBrand(brand);</span><br><span class="line">   product2.setBrand(brand);</span><br><span class="line"></span><br><span class="line">   session.save(brand);</span><br><span class="line">   <span class="comment">// 因为级联关系的设定存在,少写两行代码</span></span><br><span class="line">   <span class="comment">// session.save(product1);</span></span><br><span class="line">   <span class="comment">// session.save(product2);</span></span><br><span class="line"></span><br><span class="line">   transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Product级联Brand"><a href="#Product级联Brand" class="headerlink" title="Product级联Brand"></a>Product级联Brand</h4><p>product.cfg.xml中<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">级联操作:cascade</span></span><br><span class="line"><span class="comment">	 save-update 级联保存更新</span></span><br><span class="line"><span class="comment">	 delete  级联删除</span></span><br><span class="line"><span class="comment">	 all save-update+delete</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"brand"</span> <span class="attr">class</span>=<span class="string">"Brand"</span> <span class="attr">column</span>=<span class="string">"product_brand_id"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">	Brand brand = <span class="keyword">new</span> Brand();</span><br><span class="line">	brand.setBrand_name(<span class="string">"美特斯邦威"</span>);</span><br><span class="line"></span><br><span class="line">	Product product1 = <span class="keyword">new</span> Product();</span><br><span class="line">	product1.setProduct_name(<span class="string">"衬衫"</span>);</span><br><span class="line">	Product product2 = <span class="keyword">new</span> Product();</span><br><span class="line">	product2.setProduct_name(<span class="string">"T恤"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 建立关系</span></span><br><span class="line">	brand.getProductSet().add(product1);</span><br><span class="line">	brand.getProductSet().add(product2);</span><br><span class="line">	product1.setBrand(brand);</span><br><span class="line">	product2.setBrand(brand);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//  因为Product级联了Brand,少写一行代码</span></span><br><span class="line">	<span class="comment">// session.save(brand);</span></span><br><span class="line">	session.save(product1);</span><br><span class="line">	session.save(product2);</span><br><span class="line"></span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="级联操作的对象导航问题"><a href="#级联操作的对象导航问题" class="headerlink" title="级联操作的对象导航问题"></a>级联操作的对象导航问题</h3><p>对象导航就是对象之间关系的维护<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建立关系</span></span><br><span class="line">brand.getProductSet().add(product1);</span><br><span class="line">brand.getProductSet().add(product2);</span><br><span class="line">product1.setBrand(brand);</span><br><span class="line">product2.setBrand(brand);</span><br></pre></td></tr></table></figure></p>
<p>以下测试这种关系的用途<br>在Product和Brand双方都设置<code>save-update</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">	Brand brand = <span class="keyword">new</span> Brand();</span><br><span class="line">	brand.setBrand_name(<span class="string">"美特斯邦威"</span>);</span><br><span class="line"></span><br><span class="line">	Product product1 = <span class="keyword">new</span> Product();</span><br><span class="line">	product1.setProduct_name(<span class="string">"衬衫"</span>);</span><br><span class="line">	Product product2 = <span class="keyword">new</span> Product();</span><br><span class="line">	product2.setProduct_name(<span class="string">"T恤"</span>);</span><br><span class="line">	Product product3 = <span class="keyword">new</span> Product();</span><br><span class="line">	product3.setProduct_name(<span class="string">"毛衣"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 建立关系</span></span><br><span class="line">	product1.setBrand(brand);</span><br><span class="line">	brand.getProductSet().add(product2);</span><br><span class="line">	brand.getProductSet().add(product3);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 条件是双方都配置了cascade="save-update"</span></span><br><span class="line">	<span class="comment">// 发送4条insert语句 因为product1关联了brand 而brand关联了product2、product3  所以数据库中存在brand和product1/2/3</span></span><br><span class="line">	<span class="comment">// session.save(product1);</span></span><br><span class="line">	<span class="comment">// 发送3条insert语句 brand关联了product2、product3  所以数据库中存在brand和product2/3</span></span><br><span class="line">	<span class="comment">// session.save(brand);</span></span><br><span class="line">	<span class="comment">// 发送1条insert语句 只保存product2到数据库中</span></span><br><span class="line">	<span class="comment">// session.save(product2);</span></span><br><span class="line"></span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="级联删除"><a href="#级联删除" class="headerlink" title="级联删除"></a>级联删除</h3><h4 id="Brand级联Product-1"><a href="#Brand级联Product-1" class="headerlink" title="Brand级联Product"></a>Brand级联Product</h4><p>brand.cfg.xml中<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> 级联操作:cascade</span></span><br><span class="line"><span class="comment">	  save-update 级联保存更新</span></span><br><span class="line"><span class="comment">	  delete  级联删除</span></span><br><span class="line"><span class="comment">	  all save-update+delete</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"productSet"</span> <span class="attr">cascade</span>=<span class="string">"delete"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试代码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Session session = sessionFactory.getCurrentSession();</span><br><span class="line">  Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 级联删除：先查询再删除</span></span><br><span class="line">  Brand brand = session.get(Brand.class, <span class="number">5L</span>);</span><br><span class="line">  <span class="comment">// 数据库中对应Brand 和 与Brand相关联的Product 全被删除</span></span><br><span class="line">  session.delete(brand);</span><br><span class="line"></span><br><span class="line">  transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Product级联Brand-1"><a href="#Product级联Brand-1" class="headerlink" title="Product级联Brand"></a>Product级联Brand</h4><p>product.cfg.xml中<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置关联对象:--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--many-to-one:多对一标签 name引用属性名 class引用的对象完整列名 column外键列名--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">级联操作:cascade</span></span><br><span class="line"><span class="comment">	 save-update 级联保存更新</span></span><br><span class="line"><span class="comment">	 delete  级联删除</span></span><br><span class="line"><span class="comment">	 all save-update+delete</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"brand"</span> <span class="attr">class</span>=<span class="string">"Brand"</span> <span class="attr">column</span>=<span class="string">"product_brand_id"</span> <span class="attr">cascade</span>=<span class="string">"delete"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试代码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 级联删除：先查询再删除</span></span><br><span class="line">	Product product = session.get(Product.class, <span class="number">13L</span>);</span><br><span class="line">	<span class="comment">// 数据库中对应Product 与 Product关联的Brand被删除，其余与Brand相关联的Product的外键置为null</span></span><br><span class="line">	session.delete(product);</span><br><span class="line"></span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="关系维护的保持与放弃"><a href="#关系维护的保持与放弃" class="headerlink" title="关系维护的保持与放弃"></a>关系维护的保持与放弃</h2><h3 id="双向关联产生多余的SQL语句问题发现"><a href="#双向关联产生多余的SQL语句问题发现" class="headerlink" title="双向关联产生多余的SQL语句问题发现"></a>双向关联产生多余的SQL语句问题发现</h3><p>改变一个Product的Brand<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo7</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">	Product product = session.get(Product.class, <span class="number">14L</span>);</span><br><span class="line">	Brand brand = session.get(Brand.class, <span class="number">4L</span>);</span><br><span class="line"></span><br><span class="line">	product.setBrand(brand);</span><br><span class="line">	brand.getProductSet().add(product);</span><br><span class="line"></span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行完可以发现id为14的product外键id被成功更新成为了4<br>但console输出的sql语句如下<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		product0_.product_id <span class="keyword">as</span> product_1_2_0_,</span><br><span class="line">		product0_.product_name <span class="keyword">as</span> product_2_2_0_,</span><br><span class="line">		product0_.product_brand_id <span class="keyword">as</span> product_3_2_0_ </span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		product product0_ </span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		product0_.product_id=?</span><br><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		brand0_.brand_id <span class="keyword">as</span> brand_id1_0_0_,</span><br><span class="line">		brand0_.brand_name <span class="keyword">as</span> brand_na2_0_0_ </span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		brand brand0_ </span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		brand0_.brand_id=?</span><br><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		productset0_.product_brand_id <span class="keyword">as</span> product_3_2_0_,</span><br><span class="line">		productset0_.product_id <span class="keyword">as</span> product_1_2_0_,</span><br><span class="line">		productset0_.product_id <span class="keyword">as</span> product_1_2_1_,</span><br><span class="line">		productset0_.product_name <span class="keyword">as</span> product_2_2_1_,</span><br><span class="line">		productset0_.product_brand_id <span class="keyword">as</span> product_3_2_1_ </span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		product productset0_ </span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		productset0_.product_brand_id=?</span><br><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">update</span></span><br><span class="line">		product </span><br><span class="line">	<span class="keyword">set</span></span><br><span class="line">		product_name=?,</span><br><span class="line">		product_brand_id=? </span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		product_id=?</span><br><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">update</span></span><br><span class="line">		product </span><br><span class="line">	<span class="keyword">set</span></span><br><span class="line">		product_brand_id=? </span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		product_id=?</span><br><span class="line"></span><br><span class="line">Process finished <span class="keyword">with</span> <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>发现执行了两次update语句，且两次都是修改product的外键<br>这是因为<font color="red">持久态对象可以自动更新数据库，更新Product的时候会修改一次外键，更新联系人的时候同样也会修改一次外键</font>，这样就产生了多余的SQL语句</p>
<h3 id="问题解决方法"><a href="#问题解决方法" class="headerlink" title="问题解决方法"></a>问题解决方法</h3><p>解决方法很简单，只需要将一方放弃外键维护权就可以了，也就是说关系不是双方维护的，只需要交给一方维护。通常我们都是交给<strong>多的一方</strong>去维护的。为什么呢？因为多的一方才是维护关系的最好的地方，举个例子，一个老师对应多个学生，一个学生对应一个老师，这是典型的一对多。那么一个老师如果要记住所有学生的名字很难的，但如果让每个学生记住老师的名字应该不难。其实就是这个道理。所以在一对多中，一的一方都会放弃外键的维护权（关系的维护）。这个时候如果想让一的一方放弃外键的维护权，只需要进行如下的配置即可。</p>
<p>在多的一方的配置文件中,即Product.cfg.xml中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">inverse属性：性能优化，提高关系维护性能</span><br><span class="line">默认值为false 代表不放弃外键关系维护</span><br><span class="line">	   true  代表放弃外键关系维护</span><br><span class="line">原则：无论怎么放弃总有一方要维护关系</span><br><span class="line">	 一对多关系中，多的一方维护外键关系</span><br><span class="line">--&gt;</span><br><span class="line">&lt;set name=&quot;productSet&quot; cascade=&quot;save-update,delete&quot; inverse=&quot;true&quot;&gt;</span><br><span class="line">  &lt;!--key标签 column外键列名--&gt;</span><br><span class="line">  &lt;key column=&quot;product_brand_id&quot;&gt;&lt;/key&gt;</span><br><span class="line">  &lt;!--one-to-many标签 class集合中对象的完整类名--&gt;</span><br><span class="line">  &lt;one-to-many class=&quot;Product&quot;&gt;&lt;/one-to-many&gt;</span><br><span class="line">&lt;/set&gt;</span><br></pre></td></tr></table></figure></p>
<p>配置完成之后便不会产生多余的SQL了</p>
<h2 id="Hibernate中的多对多关系映射并操作"><a href="#Hibernate中的多对多关系映射并操作" class="headerlink" title="Hibernate中的多对多关系映射并操作"></a>Hibernate中的多对多关系映射并操作</h2><h3 id="创建测试表-1"><a href="#创建测试表-1" class="headerlink" title="创建测试表"></a>创建测试表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">user_id <span class="built_in">BIGINT</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment <span class="keyword">COMMENT</span> <span class="string">'用户id'</span>,</span><br><span class="line">user_name <span class="built_in">VARCHAR</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户名称'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> ( user_id ) </span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> auto_increment = <span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8 </span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">role</span> (</span><br><span class="line">role_id <span class="built_in">BIGINT</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment <span class="keyword">COMMENT</span> <span class="string">'角色id'</span>,</span><br><span class="line">role_name <span class="built_in">VARCHAR</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色名称'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> ( role_id ) </span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> auto_increment = <span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8 </span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_role (</span><br><span class="line">user_id <span class="built_in">BIGINT</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户id'</span>,</span><br><span class="line">role_id <span class="built_in">BIGINT</span> ( <span class="number">32</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色id'</span></span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8</span><br></pre></td></tr></table></figure>
<h3 id="创建实体类-1"><a href="#创建实体类-1" class="headerlink" title="创建实体类"></a>创建实体类</h3><p>User.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> priv.jc.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long user_id;</span><br><span class="line">	<span class="keyword">private</span> String user_name;</span><br><span class="line">	<span class="keyword">private</span> Set&lt;Role&gt; roleSet = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getUser_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser_id</span><span class="params">(Long user_id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user_id = user_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUser_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user_name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser_name</span><span class="params">(String user_name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user_name = user_name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Set&lt;Role&gt; <span class="title">getRoleSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> roleSet;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleSet</span><span class="params">(Set&lt;Role&gt; roleSet)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.roleSet = roleSet;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Role.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> priv.jc.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long role_id;</span><br><span class="line">	<span class="keyword">private</span> String role_name;</span><br><span class="line">	<span class="keyword">private</span> Set&lt;User&gt; userSet = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getRole_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> role_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRole_id</span><span class="params">(Long role_id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.role_id = role_id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getRole_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> role_name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRole_name</span><span class="params">(String role_name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.role_name = role_name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Set&lt;User&gt; <span class="title">getUserSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userSet;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserSet</span><span class="params">(Set&lt;User&gt; userSet)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.userSet = userSet;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="书写ORM元数据-2"><a href="#书写ORM元数据-2" class="headerlink" title="书写ORM元数据"></a>书写ORM元数据</h3><p>User.hbm.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">		"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">		"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"priv.jc.entity"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"user_id"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_name"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		 set标签:</span></span><br><span class="line"><span class="comment">			name:关联的另一方的集合的属性名称</span></span><br><span class="line"><span class="comment">			table：中间表的名称</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roleSet"</span> <span class="attr">table</span>=<span class="string">"user_role"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">			 key标签:</span></span><br><span class="line"><span class="comment">				colum：当前对象在中间表的外键名称</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"user_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">			 many-to-many标签：</span></span><br><span class="line"><span class="comment">				class：关联的另一方的完整类名</span></span><br><span class="line"><span class="comment">				column：关联另一方在中间表的外键名</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"Role"</span> <span class="attr">column</span>=<span class="string">"role_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">``` </span><br><span class="line">Role.hbm.xml</span><br><span class="line">```xml</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">		"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">		"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"priv.jc.entity"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Role"</span> <span class="attr">table</span>=<span class="string">"role"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"role_id"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		 set标签:</span></span><br><span class="line"><span class="comment">			name:关联的另一方的集合的属性名称</span></span><br><span class="line"><span class="comment">			table：中间表的名称</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"userSet"</span> <span class="attr">table</span>=<span class="string">"user_role"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">			 key标签:</span></span><br><span class="line"><span class="comment">				colum：当前对象在中间表的外键名称</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"role_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">			 many-to-many标签：</span></span><br><span class="line"><span class="comment">				class：关联的另一方的完整类名</span></span><br><span class="line"><span class="comment">				column：关联另一方在中间表的外键名</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"User"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="配置文件中加载映射-1"><a href="#配置文件中加载映射-1" class="headerlink" title="配置文件中加载映射"></a>配置文件中加载映射</h3><p>hibernate.cfg.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"priv/jc/entity/User.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"priv/jc/entity/Role.hbm.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="测试Demo"><a href="#测试Demo" class="headerlink" title="测试Demo"></a>测试Demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line">	Role role1 = <span class="keyword">new</span> Role();</span><br><span class="line">	Role role2 = <span class="keyword">new</span> Role();</span><br><span class="line">	Role role3 = <span class="keyword">new</span> Role();</span><br><span class="line">	role1.setRole_name(<span class="string">"开发"</span>);</span><br><span class="line">	role2.setRole_name(<span class="string">"测试"</span>);</span><br><span class="line">	role3.setRole_name(<span class="string">"运维"</span>);</span><br><span class="line"></span><br><span class="line">	User user1 = <span class="keyword">new</span> User();</span><br><span class="line">	User user2 = <span class="keyword">new</span> User();</span><br><span class="line">	user1.setUser_name(<span class="string">"小明"</span>);</span><br><span class="line">	user2.setUser_name(<span class="string">"小王"</span>);</span><br><span class="line"></span><br><span class="line">	user1.getRoleSet().add(role1);</span><br><span class="line">	user1.getRoleSet().add(role3);</span><br><span class="line">	user2.getRoleSet().add(role2);</span><br><span class="line">	user2.getRoleSet().add(role3);</span><br><span class="line"></span><br><span class="line">	role1.getUserSet().add(user1);</span><br><span class="line">	role2.getUserSet().add(user1);</span><br><span class="line">	role2.getUserSet().add(user2);</span><br><span class="line">	role3.getUserSet().add(user2);</span><br><span class="line"></span><br><span class="line">	session.save(role1);</span><br><span class="line">	session.save(role2);</span><br><span class="line">	session.save(role3);</span><br><span class="line">	session.save(user1);</span><br><span class="line">	session.save(user2);</span><br><span class="line"></span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="多对多的关系维护问题"><a href="#多对多的关系维护问题" class="headerlink" title="多对多的关系维护问题"></a>多对多的关系维护问题</h3><p>在多对多的保存操作中，如果进行了双向维护关系，就必须有一方放弃外键维护权。一般由被动方放弃，用户主动选择角色，角色是被选择的，所以一般角色要回放弃外键维护权。但如果只进行单向维护关系，那么就不需要放弃外键维护权了。</p>
<h3 id="多对多的其他操作"><a href="#多对多的其他操作" class="headerlink" title="多对多的其他操作"></a>多对多的其他操作</h3><h4 id="给某个用户添加角色"><a href="#给某个用户添加角色" class="headerlink" title="给某个用户添加角色"></a>给某个用户添加角色</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得id为2的用户</span></span><br><span class="line">	User user = session.get(User.class, <span class="number">2L</span>);</span><br><span class="line">	<span class="comment">// 获得id为2的角色</span></span><br><span class="line">	Role role2 = session.get(Role.class, <span class="number">2L</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 操作集合相当于操作中间表</span></span><br><span class="line">	user.getRoleSet().add(role2);</span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="删除某个用户的角色"><a href="#删除某个用户的角色" class="headerlink" title="删除某个用户的角色"></a>删除某个用户的角色</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得id为2的用户</span></span><br><span class="line">	User user = session.get(User.class, <span class="number">2L</span>);</span><br><span class="line">	<span class="comment">// 获得id为1的角色</span></span><br><span class="line">	Role role = session.get(Role.class, <span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 操作集合相当于操作中间表</span></span><br><span class="line">	user.getRoleSet().remove(role);</span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="修改某个用户的角色"><a href="#修改某个用户的角色" class="headerlink" title="修改某个用户的角色"></a>修改某个用户的角色</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span></span>&#123;</span><br><span class="line">   Session session = sessionFactory.getCurrentSession();</span><br><span class="line">   Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 获得id为2的用户</span></span><br><span class="line">   User user = session.get(User.class, <span class="number">2L</span>);</span><br><span class="line">   <span class="comment">// 获得id为1的角色</span></span><br><span class="line">   Role role1 = session.get(Role.class, <span class="number">1L</span>);</span><br><span class="line">   <span class="comment">// 获得id为2的角色</span></span><br><span class="line">   Role role2 = session.get(Role.class, <span class="number">2L</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 操作集合相当于操作中间表</span></span><br><span class="line">   user.getRoleSet().remove(role1);</span><br><span class="line">   user.getRoleSet().add(role2)</span><br><span class="line">   transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Hibernate的检索方式"><a href="#Hibernate的检索方式" class="headerlink" title="Hibernate的检索方式"></a>Hibernate的检索方式</h2><h3 id="对象图导航检索"><a href="#对象图导航检索" class="headerlink" title="对象图导航检索"></a>对象图导航检索</h3><p>对象图导航检索方式是根据己经加载的对象，导航到他的关联对象。它利用类与类之间的关系来检索对象。譬如要查找一个联系人对应的客户，就可以由联系人对象自动导航找到联系人所属的客户对象。当然，前提是必须在对象关系映射文件上配置了多对一的关系。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LinkMan linkMan = (LinkMan)session.get(LinkMan.class,<span class="number">11</span>);</span><br><span class="line">Customer customer = linkMan.getCustomer();</span><br></pre></td></tr></table></figure></p>
<h3 id="OID检索方式"><a href="#OID检索方式" class="headerlink" title="OID检索方式"></a>OID检索方式</h3><p>OID检索方式主要指用Session的get()和load()方法加载某条记录对应的对象。如下面两种加载客户对象的方式，就是OID检索方式，具体如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Customer customer = (Customer)session.get(Customer.class,<span class="number">1</span>);</span><br><span class="line">Customer customer = (Customer)session.load(Customer.class,<span class="number">1</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="HQL检索"><a href="#HQL检索" class="headerlink" title="HQL检索"></a>HQL检索</h3><p>HQL(Hibernate Query Language)是面向对象的查询语言，它和SQL查询语言有些相似，但它使用的是类、对象和属性的概念，而没有表和字段的概念。在Hibernate提供的各种检索方式中，HQL是官方推荐的查询语言，也是使用最广泛的一种检索方式。它具有如下功能。</p>
<ul>
<li>在查询语句中设定各种查询条件。</li>
<li>支持投影查询，即仅检索出对象的部分属性。</li>
<li>支持分页查询。</li>
<li>支持分组查询，允许使用group by和having关键字。</li>
<li>提供内置聚集函数，如sum()、min()和max()。</li>
<li>能够调用用户定义的SQL函数。</li>
<li>支持子查询，即嵌套查询。</li>
<li>支持动态绑定参数</li>
</ul>
<p>Hibernate提供的Query接口是专门的HQL查询接口，它能够执行各种复杂的HQL查询语句。完整的HQL语句结构如下。<br><code>select...from...where...group by...having...order by...asc/desc</code><br>可见HQL查询非常类似于标准SQL查询。通常情况下，当检索数据表中的所有记录时，查询语句中可以省略select关键字，示例如下所示。<br><code>String hql=&quot;from Customer&quot;；</code><br>如果执行该查询语句，则会返回应用程序中的所有Customer对象，需要注意的是Customer是类名，而不是表名，类名需要区分大小写，而关键字from不区分大小写。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1.基本查询</span></span><br><span class="line">	Query query = session.createQuery(<span class="string">"from Customer c"</span>);</span><br><span class="line">	List&lt;Customer&gt; list = query.list();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2.排序查询</span></span><br><span class="line">	Query query1 = session.createQuery(<span class="string">"from Customer c order by c.cust_id desc"</span>);</span><br><span class="line">	List&lt;Customer&gt; list1 = query1.list();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3.条件查询</span></span><br><span class="line">	<span class="comment">// a.按位置绑定参数</span></span><br><span class="line">	Query query2 = session.createQuery(<span class="string">"from Customer c where c.cust_name = ?"</span>);</span><br><span class="line">	<span class="comment">// query2.setString(0, "小明");</span></span><br><span class="line">	query2.setParameter(<span class="number">0</span>, <span class="string">"小明"</span>);</span><br><span class="line">	List&lt;Customer&gt; list2 = query2.list();</span><br><span class="line">	<span class="comment">// b.按名称绑定参数</span></span><br><span class="line">	Query query3 = session.createQuery(<span class="string">"from Customer c where c.cust_name = :name"</span>);</span><br><span class="line">	<span class="comment">// query3.setString("name", "小明");</span></span><br><span class="line">	query3.setParameter(<span class="string">"name"</span>, <span class="string">"小明"</span>);</span><br><span class="line">	List&lt;Customer&gt; list3 = query3.list();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4.分页查询</span></span><br><span class="line">	Query query4 = session.createQuery(<span class="string">"from Customer order by cust_id desc"</span>);</span><br><span class="line">	query.setFirstResult(<span class="number">1</span>);</span><br><span class="line">	query.setMaxResults(<span class="number">2</span>);</span><br><span class="line">	List&lt;Customer&gt; list4 = query4.list();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 5.统计查询</span></span><br><span class="line">	Query query5 = session.createQuery(<span class="string">"select count(*) from Customer"</span>);</span><br><span class="line">	Long count = (Long) query5.uniqueResult();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 6.投影查询(查询某一列 或 某几列)</span></span><br><span class="line">	<span class="comment">// a.投影查询一列</span></span><br><span class="line">	Query query6 = session.createQuery(<span class="string">"select cust_name from Customer"</span>);</span><br><span class="line">	<span class="comment">// 参数不自动封装到Customer对象</span></span><br><span class="line">	List&lt;String&gt; list6 = query6.list();</span><br><span class="line">	<span class="comment">// b.投影查询多列</span></span><br><span class="line">	Query query7 = session.createQuery(<span class="string">"select cust_id,cust_name from Customer"</span>);</span><br><span class="line">	<span class="comment">// 参数不自动封装到Customer对象</span></span><br><span class="line">	List&lt;Object&gt; list7 = query7.list();</span><br><span class="line">	Query query8 = session.createQuery(<span class="string">"select new Customer(cust_id,cust_name) from Customer"</span>);</span><br><span class="line">	<span class="comment">// 参数封装到Customer对象 注意创建对应参数的构造函数</span></span><br><span class="line">	List&lt;Customer&gt; list8 = query8.list();</span><br><span class="line"></span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="QBC检索"><a href="#QBC检索" class="headerlink" title="QBC检索"></a>QBC检索</h3><p>QBC(Query By Criteria)是Hibernate提供的另一种检索对象的方式，它主要由Criteria接口、Criterion接口和Expression类组成。Criteria接口是Hibernate API中的一个查询接口，它需要由Session进行创建。Criterion是Criteria的查询条件，在Criteria中提供了add(Criterion criterion)方法来添加查询条件。</p>
<p>QBC检索是使用Restrictions对象编写查询条件的，在Restrictions类中提供了大量的静态方法来创建查询条件。其常用的方法如表所示。</p>
<table>
<thead>
<tr>
<th style="text-align:center">方法名</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>Restrictions.eq</code></td>
<td style="text-align:center">等于</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.allEq</code></td>
<td style="text-align:center">使用Map，使用key/value进行多个等于的比较</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.gt</code></td>
<td style="text-align:center">大于</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.ge</code></td>
<td style="text-align:center">大于等于</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.lt</code></td>
<td style="text-align:center">小于</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.le</code></td>
<td style="text-align:center">小于等于</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.between</code></td>
<td style="text-align:center">对应SQL的Between子句</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.like</code></td>
<td style="text-align:center">对应SQL的like子句</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.in</code></td>
<td style="text-align:center">对应SQL的in子句</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.and</code></td>
<td style="text-align:center">and关系</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.or</code></td>
<td style="text-align:center">or关系</td>
</tr>
<tr>
<td style="text-align:center"><code>Restrictions.sqlRestriction</code></td>
<td style="text-align:center">SQL限定查询</td>
</tr>
</tbody>
</table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1.基本搜索</span></span><br><span class="line">	Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">	List&lt;Customer&gt; list = criteria.list();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2.条件查询</span></span><br><span class="line">	Criteria criteria1 = session.createCriteria(Customer.class);</span><br><span class="line">	criteria1.add(Restrictions.eq(<span class="string">"cust_id"</span>, <span class="number">1L</span>));</span><br><span class="line">	criteria1.add(Restrictions.like(<span class="string">"cust_name"</span>, <span class="string">"%明%"</span>));</span><br><span class="line">	List&lt;Customer&gt; list1 = criteria1.list();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3.分页查询</span></span><br><span class="line">	Criteria criteria2 = session.createCriteria(Customer.class);</span><br><span class="line">	criteria2.setFirstResult(<span class="number">1</span>);</span><br><span class="line">	criteria2.setMaxResults(<span class="number">2</span>);</span><br><span class="line">	List&lt;Customer&gt; list2 = criteria2.list();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4.排序查询</span></span><br><span class="line">	Criteria criteria3 = session.createCriteria(Customer.class);</span><br><span class="line">	criteria3.addOrder(Order.desc(<span class="string">"cust_id"</span>));</span><br><span class="line">	List&lt;Customer&gt; list3 = criteria3.list();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 5.统计查询</span></span><br><span class="line">	<span class="comment">// a.统计count</span></span><br><span class="line">	Criteria criteria4 = session.createCriteria(Customer.class);</span><br><span class="line">	criteria4.setProjection(Projections.rowCount());</span><br><span class="line">	Long count = (Long) criteria4.uniqueResult();</span><br><span class="line">	<span class="comment">// b.统计max</span></span><br><span class="line">	Criteria criteria5 = session.createCriteria(Customer.class);</span><br><span class="line">	criteria5.setProjection(Projections.max(<span class="string">"cust_id"</span>));</span><br><span class="line">	String custId = (String) criteria5.uniqueResult();</span><br><span class="line">	<span class="comment">// c.投影列表</span></span><br><span class="line">	Criteria criteria6 = session.createCriteria(Customer.class);</span><br><span class="line">	ProjectionList projList = Projections.projectionList();</span><br><span class="line">	projList.add(Projections.max(<span class="string">"cust_id"</span>));</span><br><span class="line">	projList.add(Projections.min(<span class="string">"cust_id"</span>));</span><br><span class="line">	projList.add(Projections.avg(<span class="string">"cust_id"</span>));</span><br><span class="line">	<span class="comment">// countDistinct (String propertyName)：统计属性包含的不重复值的数量。</span></span><br><span class="line">	projList.add(Projections.countDistinct(<span class="string">"cust_id"</span>));</span><br><span class="line">	criteria6.setProjection(projList);</span><br><span class="line">	<span class="comment">// 执行了多个统计投影。当执行多个统计投影时，会获取一个 List，并且是一个 Object 类型的 List，其中依次包含所有的统计投影结果。</span></span><br><span class="line">	List result = criteria6.list();</span><br><span class="line"></span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="离线条件检索"><a href="#离线条件检索" class="headerlink" title="离线条件检索"></a>离线条件检索</h3><p>Detached Criteria翻译为离线条件查询，因为它是可以脱离Session来使用的一种条件查询对象，我们都知道Criteria对象必须由Session对象来创建。那么也就是说必须先有Session才可以生成Criteria对象。而Detached Criteria对象可以在其他层对条件进行封装。这个对象也是比较有用的，尤其在SSH整合以后这个对象经常会使用。它的主要优点是做一些特别复杂的条件查询的时候，往往会在WEB层向业务层传递很多的参数，业务层又会将这些参数传递给DAO层。最后在DAO中拼接SQL完成查询。有了离线条件查询对象后，那么这些工作都可以不用关心了，我们可以在WEB层将数据封装好，传递到业务层，再由业务层传递给DAO完成查询。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	DetachedCriteria detachedCriteria = DetachedCriteria.forClass(Customer.class);</span><br><span class="line">	detachedCriteria.add(Restrictions.eq(<span class="string">"cust_id"</span>, <span class="number">1L</span>));</span><br><span class="line"></span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line">	<span class="comment">// DetachedCriteria与Session绑定</span></span><br><span class="line">	Criteria criteria = detachedCriteria.getExecutableCriteria(session);</span><br><span class="line">	List&lt;Customer&gt; list = criteria.list();</span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="本地SQL检索"><a href="#本地SQL检索" class="headerlink" title="本地SQL检索"></a>本地SQL检索</h3><p>采用HQL或QBC检索方式时，Hibernate生成标准的SQL查询语句，适用于所有的数据库平台，因此这两种检索方式都是跨平台的。但有的应用程序可能需要根据底层数据库的SQL方言，来生成一些特殊的查询语句。在这种情况下，可以利用Hibernate提供的SQL检索方式。使用SQL检索方式检索对象。</p>
<p><code>session.createSQLQuery(&quot;select cust_id,cust_name from customer order by cust_id desc&quot;);</code></p>
<h2 id="Hibernate的多表查询"><a href="#Hibernate的多表查询" class="headerlink" title="Hibernate的多表查询"></a>Hibernate的多表查询</h2><h3 id="原生SQL多表查询"><a href="#原生SQL多表查询" class="headerlink" title="原生SQL多表查询"></a>原生SQL多表查询</h3><p><img src="https://hexoblog-1257009793.cos.ap-shanghai.myqcloud.com/19-3-6%20Hibernate%E6%80%BB%E7%BB%93%E7%AF%87/%E5%8E%9F%E7%94%9FSQL%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2.png" alt=""></p>
<h3 id="HQL连接查询"><a href="#HQL连接查询" class="headerlink" title="HQL连接查询"></a>HQL连接查询</h3><h4 id="种类"><a href="#种类" class="headerlink" title="种类"></a>种类</h4><ul>
<li>交叉连接</li>
<li>内连接<ul>
<li>显式内连接</li>
<li>隐式内连接</li>
<li><font color="red">迫切内连接</font></li>
</ul>
</li>
<li>外连接<ul>
<li>左外连接</li>
<li><font color="red">迫切做外连接</font></li>
<li>右外连接</li>
<li><font color="red">迫切右外连接</font>

</li>
</ul>
</li>
</ul>
<h4 id="迫切连接fetch"><a href="#迫切连接fetch" class="headerlink" title="迫切连接fetch"></a>迫切连接fetch</h4><p>以内连接为例<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SQL显式内连接</span></span><br><span class="line">select * from brand b inner join product p on b.brand_id = p.product_brand_id.</span><br><span class="line"><span class="comment">// HQL显式内连接</span></span><br><span class="line"><span class="comment">// 在HQL中，我们不用写关联字段了，因为Brand中的Product的集合其实对应的就是外键，所以我们在inner join的后面直接可以写b.proudctSet。</span></span><br><span class="line">from Brand b inner join b.proudctSet</span><br><span class="line"><span class="comment">// 迫切内连接</span></span><br><span class="line">from Brand b inner join fetch b.proudctSet</span><br></pre></td></tr></table></figure></p>
<p><strong>HQL内连接与迫切内连接区别:</strong></p>
<p><strong>内连接</strong>在封装数据的时候，普通内连接会将属于Brand的数据封装到Brand对象中，会将属于Product的数据封装到Product对象中，所以每条记录都会是装有两个对象的集合，所以封装以后的数据是<code>List&lt;Object[]&gt;</code>，在<code>Object[]</code>中有两个对象一个是Brand另一个是Product。</p>
<p><strong>迫切内连接</strong>,加了fetch以后，虽然我们查询到的数据是一样的，但是Hibernate发现HQL中有fetch就会将数据封装到一个对象中，把属于Brand的数据封装到Brand对象中，将属于Product的部分封装到Brand中的Product的集合中，这样最后封装完成以后是一个<code>List&lt;Brand&gt;</code>中。</p>
<p>但是迫切内连接封装以后会出现重复的数据，所以往往自己在手动编写迫切内连接的时候会使用<br>distinct去掉重复值。</p>
<p><code>select distinct b from Brand b inner join fetch b.proudctSet</code></p>
<h2 id="Hibernate的抓取策略"><a href="#Hibernate的抓取策略" class="headerlink" title="Hibernate的抓取策略"></a>Hibernate的抓取策略</h2><p>抓取策略是当应用程序需要在(Hibernate实体对象图的）关联关系间进行导航的时候，Hibernate如何获取关联对象的策略。Hibernate的抓取策略是Hibernate提升性能的一种手段，可以在获取关联对象的时候，对发送的语句进行优化，但是往往抓取策略需要和延迟加载一起使用来提升性能。</p>
<h3 id="延迟加载（懒加载）"><a href="#延迟加载（懒加载）" class="headerlink" title="延迟加载（懒加载）"></a>延迟加载（懒加载）</h3><p>延迟加载(lazyload)是(也称为懒加载)，Hibernate关联关系对象默认的加载方式，延迟加载机制是为了避免一些无谓的性能开销而提出来的，所谓延迟加载就是当在真正需要数据的时候，才真正执行数据加载操作。</p>
<p>通常将延迟加载分为两类：一类叫做类级别延迟，另一类叫做关联级别的延迟。类级别的延迟指的是查询某个对象的时候，是否采用有延迟，这个通常在<code>&lt;class&gt;</code>标签上配置lazy属性。关联级别的延迟指的是，查询一个对象的关联对象的时候是否采用延迟加载。这个通常在<code>&lt;set&gt;</code>或<code>&lt;many-to-one&gt;</code>上配置lazy属性。<font color="red">lazy控制的是查询其关联对象的时候是否采用延迟加载的策略</font></p>
<h4 id="类级别的延迟加载"><a href="#类级别的延迟加载" class="headerlink" title="类级别的延迟加载"></a>类级别的延迟加载</h4><p><strong>使用load方法检索某个对象的时候，这个类是否采用延迟加载的策略，就是类级别的延迟。使用get方法没有任何策略.调用即立即查询数据库加载数据</strong>。类级别的延迟一般在<code>&lt;class&gt;</code>上配置lazy属性，lazy的默认值是true默认是延迟加载的，所以使用load方法去查询的时候，不会马上发送SQL语句，当真正使用该对象的时候，才会发送SQL语句。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"priv.jc.entity"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	lazy(默认值):true, 查询类时,会返回代理对象.会在使用属性时,根据关联的session查询数据库.加载数据.</span></span><br><span class="line"><span class="comment">	lazy:false. load方法会与get方法没有任何区别.调用时即加载数据.</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Brand"</span> <span class="attr">table</span>=<span class="string">"brand"</span> <span class="attr">lazy</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p><code>Customer customer=session.load(Customer.class,11);</code></p>
<p>其实如果不想使用延迟加载也有很多种方法，当然最简单的就是将这个类的映射文件上的lazy设置为false,当然也可以将这个持久化类改为final修饰，如果改为final修饰的话。就无法生成代理类，就会使延迟加载失效。这是类级别的延迟加载，类级别的延迟加载一般我们不进行修改，采用默认值lazy=”true”就可以了。其实主要的是关联级别的延迟加载，关键级别的延迟加载指的是查询到某个对象以后，检索它的关联对象的时候是否采用延迟加载。</p>
<h4 id="关联级别的延迟加载"><a href="#关联级别的延迟加载" class="headerlink" title="关联级别的延迟加载"></a>关联级别的延迟加载</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Brand brand = session.get(Brand.clss,<span class="number">1l</span>);</span><br><span class="line">Set&lt;Proudct&gt; productSet = brand.getProductSet();</span><br></pre></td></tr></table></figure>
<p>通过Brand查询其关联的Proudct对象，在查询Product的时候是否釆用延迟加载称为是关联级别的延迟加载。关联级别的延迟通常是在<code>&lt;set&gt;</code>和<code>&lt;many-to-one&gt;</code>上来进行配置。</p>
<p><strong>lazy(<code>&lt;set&gt;</code>)</strong></p>
<ul>
<li>true(默认值) 采用延迟加载</li>
<li>false 不采用延迟加载</li>
<li>extra 及其懒惰的</li>
</ul>
<p><strong>lazy(<code>&lt;many-to-one&gt;</code>)</strong></p>
<ul>
<li>proxy(默认值) 是否采用延迟取决于 <strong>一的一方</strong> 类上的lazy属性的值</li>
<li>false 不采用懒加载</li>
<li>no proxy 无代理延迟加载</li>
</ul>
<h3 id="抓取策略"><a href="#抓取策略" class="headerlink" title="抓取策略"></a>抓取策略</h3><p>抓取策略指的是查询到某个对象的时候，如何抓取其关联对象。这个也可以通过配置完成。在<br>关联对象的标签上配置<code>fetch</code>属性。关联上就分为是在<code>&lt;set&gt;</code>和<code>&lt;many-to-one&gt;</code>上，也都有不同的取值。<font color="red">fetch控制的是查询其关联对象的时候采用的SQL语句的格式。fetch设置为join时,lazy会失效。</font></p>
<p><strong>fetch(<code>&lt;set&gt;</code>)</strong></p>
<ul>
<li>select(默认值) 发送普通的select语句去查询关联对象</li>
<li>join 发送一条迫切左外连接去查询关联对象</li>
<li>subselect 发送一条子查询语句查询其关联对象</li>
</ul>
<p><strong>fetch(<code>&lt;many-to-one&gt;</code>)</strong></p>
<ul>
<li>select(默认值) 发送普通的select语句去查询关联对象</li>
<li>join 发送一条迫切左外连接去查询关联对象</li>
</ul>
<h4 id="批量抓取"><a href="#批量抓取" class="headerlink" title="批量抓取"></a>批量抓取</h4><p>在抓取的策略中有一种叫做批量抓取，就是同时查询多个对象的关联对象的时候，可以采用批<br>量抓取进行优化。</p>
<p>如果要实现批量的抓取效果，可以通过配置batch-size来完成。</p>
<p><strong>未设置batch-size</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Session session = sessionFactory.getCurrentSession();</span><br><span class="line">	Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">	List&lt;Brand&gt; brandList = session.createQuery(<span class="string">"from Brand"</span>).list();</span><br><span class="line">	<span class="keyword">for</span> (Brand brand : brandList) &#123;</span><br><span class="line">		System.out.println(<span class="string">"Brand名称: "</span> + brand.getBrand_name());</span><br><span class="line">		<span class="keyword">for</span> (Product product : brand.getProductSet()) &#123;</span><br><span class="line">			System.out.println(<span class="string">"Brand对应的Product名称："</span> + product.getProduct_name());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		brand0_.brand_id <span class="keyword">as</span> brand_id1_0_,</span><br><span class="line">		brand0_.brand_name <span class="keyword">as</span> brand_na2_0_ </span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		brand brand0_</span><br><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		productset0_.product_brand_id <span class="keyword">as</span> product_3_2_0_,</span><br><span class="line">		productset0_.product_id <span class="keyword">as</span> product_1_2_0_,</span><br><span class="line">		productset0_.product_id <span class="keyword">as</span> product_1_2_1_,</span><br><span class="line">		productset0_.product_name <span class="keyword">as</span> product_2_2_1_,</span><br><span class="line">		productset0_.product_brand_id <span class="keyword">as</span> product_3_2_1_ </span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		product productset0_ </span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		productset0_.product_brand_id=?</span><br><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		productset0_.product_brand_id <span class="keyword">as</span> product_3_2_0_,</span><br><span class="line">		productset0_.product_id <span class="keyword">as</span> product_1_2_0_,</span><br><span class="line">		productset0_.product_id <span class="keyword">as</span> product_1_2_1_,</span><br><span class="line">		productset0_.product_name <span class="keyword">as</span> product_2_2_1_,</span><br><span class="line">		productset0_.product_brand_id <span class="keyword">as</span> product_3_2_1_ </span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		product productset0_ </span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		productset0_.product_brand_id=?</span><br></pre></td></tr></table></figure></p>
<p>发现执行代码会执行3条SQL，其中有两条重复的查询不同Product的SQL语句，那能不能1条SQL查询出所有的Product数据呢，可在配置文件的<code>&lt;set&gt;</code>标签上配置batch-size实现<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"productSet"</span> <span class="attr">batch-size</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--key标签 column外键列名--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"product_brand_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--one-to-many标签 class集合中对象的完整类名--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"Product"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-many</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>结果<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		brand0_.brand_id <span class="keyword">as</span> brand_id1_0_,</span><br><span class="line">		brand0_.brand_name <span class="keyword">as</span> brand_na2_0_ </span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		brand brand0_</span><br><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		productset0_.product_brand_id <span class="keyword">as</span> product_3_2_0_,</span><br><span class="line">		productset0_.product_id <span class="keyword">as</span> product_1_2_0_,</span><br><span class="line">		productset0_.product_id <span class="keyword">as</span> product_1_2_1_,</span><br><span class="line">		productset0_.product_name <span class="keyword">as</span> product_2_2_1_,</span><br><span class="line">		productset0_.product_brand_id <span class="keyword">as</span> product_3_2_1_ </span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		product productset0_ </span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		productset0_.product_brand_id=?</span><br><span class="line">Hibernate: </span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		productset0_.product_brand_id <span class="keyword">as</span> product_3_2_0_,</span><br><span class="line">		productset0_.product_id <span class="keyword">as</span> product_1_2_0_,</span><br><span class="line">		productset0_.product_id <span class="keyword">as</span> product_1_2_1_,</span><br><span class="line">		productset0_.product_name <span class="keyword">as</span> product_2_2_1_,</span><br><span class="line">		productset0_.product_brand_id <span class="keyword">as</span> product_3_2_1_ </span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		product productset0_ </span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		productset0_.product_brand_id <span class="keyword">in</span> ( ? , ?)</span><br></pre></td></tr></table></figure></p>
<p>这是在查询所有Brand时候批量抓取Product，那如果要在查询Product批量抓取Brand呢,这时同样需要配置batch-size，但是不是在<code>&lt;many-to-one&gt;</code>上配置，在Product一端的<code>&lt;class&gt;</code>配置。</p>

      
    </div>
    
    
    

  <div>
    
    <div>
    
        <div style="text-align:center;color: #555;font-size:14px;">-------------The End-------------</div>
    
</div>
    
  </div>

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Hibernate/" rel="tag"><i class="fa fa-tag"></i>Hibernate</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/02/21/集合转数组总结/" rel="next" title="list转array总结">
                <i class="fa fa-chevron-left"></i> list转array总结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/06/Struts2总结篇/" rel="prev" title="Struts2总结篇">
                Struts2总结篇 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="JiachengLai" />
            
              <p class="site-author-name" itemprop="name">JiachengLai</p>
              <p class="site-description motion-element" itemprop="description">纸上得来终觉浅，绝知此事要躬行</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是Hibernate"><span class="nav-number">1.</span> <span class="nav-text">什么是Hibernate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate的优点"><span class="nav-number">2.</span> <span class="nav-text">Hibernate的优点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#快速入门"><span class="nav-number">3.</span> <span class="nav-text">快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JAR包导入"><span class="nav-number">3.1.</span> <span class="nav-text">JAR包导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据准备"><span class="nav-number">3.2.</span> <span class="nav-text">数据准备</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#准备customer表"><span class="nav-number">3.2.1.</span> <span class="nav-text">准备customer表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#准备Customer实体"><span class="nav-number">3.2.2.</span> <span class="nav-text">准备Customer实体</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#书写ORM元数据"><span class="nav-number">3.3.</span> <span class="nav-text">书写ORM元数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-Hibernate-的核心配置文件"><span class="nav-number">3.4.</span> <span class="nav-text">创建 Hibernate 的核心配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#入门Demo"><span class="nav-number">3.5.</span> <span class="nav-text">入门Demo</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#核心接口解析"><span class="nav-number">4.</span> <span class="nav-text">核心接口解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SessionFactory：Session工厂对象"><span class="nav-number">4.1.</span> <span class="nav-text">SessionFactory：Session工厂对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简介"><span class="nav-number">4.1.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第三方连接池的配置与使用"><span class="nav-number">4.1.2.</span> <span class="nav-text">第三方连接池的配置与使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session"><span class="nav-number">4.2.</span> <span class="nav-text">Session</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Transaction"><span class="nav-number">4.3.</span> <span class="nav-text">Transaction</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate实体类创建注意事项"><span class="nav-number">5.</span> <span class="nav-text">Hibernate实体类创建注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate主键生成策略"><span class="nav-number">6.</span> <span class="nav-text">Hibernate主键生成策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate的对象状态"><span class="nav-number">7.</span> <span class="nav-text">Hibernate的对象状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate中的缓存"><span class="nav-number">8.</span> <span class="nav-text">Hibernate中的缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一级缓存"><span class="nav-number">8.1.</span> <span class="nav-text">一级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#介绍"><span class="nav-number">8.1.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#特点"><span class="nav-number">8.1.2.</span> <span class="nav-text">特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#快照区"><span class="nav-number">8.1.3.</span> <span class="nav-text">快照区</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate中的事务"><span class="nav-number">9.</span> <span class="nav-text">Hibernate中的事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是事务"><span class="nav-number">9.1.</span> <span class="nav-text">什么是事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务的特性"><span class="nav-number">9.2.</span> <span class="nav-text">事务的特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务的并发问题"><span class="nav-number">9.3.</span> <span class="nav-text">事务的并发问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务的隔离级别"><span class="nav-number">9.4.</span> <span class="nav-text">事务的隔离级别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hibernate的事务管理"><span class="nav-number">9.5.</span> <span class="nav-text">Hibernate的事务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#隔离级别的设置"><span class="nav-number">9.5.1.</span> <span class="nav-text">隔离级别的设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#保证Service层开启事务的和DAO层操纵数据库Session相同"><span class="nav-number">9.5.2.</span> <span class="nav-text">保证Service层开启事务的和DAO层操纵数据库Session相同</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用API"><span class="nav-number">10.</span> <span class="nav-text">常用API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Query"><span class="nav-number">10.1.</span> <span class="nav-text">Query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Criteria"><span class="nav-number">10.2.</span> <span class="nav-text">Criteria</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NativeQuery"><span class="nav-number">10.3.</span> <span class="nav-text">NativeQuery</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate中的一对多关系映射并操作"><span class="nav-number">11.</span> <span class="nav-text">Hibernate中的一对多关系映射并操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建测试表"><span class="nav-number">11.1.</span> <span class="nav-text">创建测试表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建实体类"><span class="nav-number">11.2.</span> <span class="nav-text">创建实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#书写ORM元数据-1"><span class="nav-number">11.3.</span> <span class="nav-text">书写ORM元数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置文件中加载映射"><span class="nav-number">11.4.</span> <span class="nav-text">配置文件中加载映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试demo"><span class="nav-number">11.5.</span> <span class="nav-text">测试demo</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#级联操作"><span class="nav-number">12.</span> <span class="nav-text">级联操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#级联保存"><span class="nav-number">12.1.</span> <span class="nav-text">级联保存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Brand级联Product"><span class="nav-number">12.1.1.</span> <span class="nav-text">Brand级联Product</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Product级联Brand"><span class="nav-number">12.1.2.</span> <span class="nav-text">Product级联Brand</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#级联操作的对象导航问题"><span class="nav-number">12.2.</span> <span class="nav-text">级联操作的对象导航问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#级联删除"><span class="nav-number">12.3.</span> <span class="nav-text">级联删除</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Brand级联Product-1"><span class="nav-number">12.3.1.</span> <span class="nav-text">Brand级联Product</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Product级联Brand-1"><span class="nav-number">12.3.2.</span> <span class="nav-text">Product级联Brand</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关系维护的保持与放弃"><span class="nav-number">13.</span> <span class="nav-text">关系维护的保持与放弃</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#双向关联产生多余的SQL语句问题发现"><span class="nav-number">13.1.</span> <span class="nav-text">双向关联产生多余的SQL语句问题发现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#问题解决方法"><span class="nav-number">13.2.</span> <span class="nav-text">问题解决方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate中的多对多关系映射并操作"><span class="nav-number">14.</span> <span class="nav-text">Hibernate中的多对多关系映射并操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建测试表-1"><span class="nav-number">14.1.</span> <span class="nav-text">创建测试表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建实体类-1"><span class="nav-number">14.2.</span> <span class="nav-text">创建实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#书写ORM元数据-2"><span class="nav-number">14.3.</span> <span class="nav-text">书写ORM元数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置文件中加载映射-1"><span class="nav-number">14.4.</span> <span class="nav-text">配置文件中加载映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试Demo"><span class="nav-number">14.5.</span> <span class="nav-text">测试Demo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多对多的关系维护问题"><span class="nav-number">14.6.</span> <span class="nav-text">多对多的关系维护问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多对多的其他操作"><span class="nav-number">14.7.</span> <span class="nav-text">多对多的其他操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#给某个用户添加角色"><span class="nav-number">14.7.1.</span> <span class="nav-text">给某个用户添加角色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#删除某个用户的角色"><span class="nav-number">14.7.2.</span> <span class="nav-text">删除某个用户的角色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改某个用户的角色"><span class="nav-number">14.7.3.</span> <span class="nav-text">修改某个用户的角色</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate的检索方式"><span class="nav-number">15.</span> <span class="nav-text">Hibernate的检索方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#对象图导航检索"><span class="nav-number">15.1.</span> <span class="nav-text">对象图导航检索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OID检索方式"><span class="nav-number">15.2.</span> <span class="nav-text">OID检索方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HQL检索"><span class="nav-number">15.3.</span> <span class="nav-text">HQL检索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QBC检索"><span class="nav-number">15.4.</span> <span class="nav-text">QBC检索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#离线条件检索"><span class="nav-number">15.5.</span> <span class="nav-text">离线条件检索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#本地SQL检索"><span class="nav-number">15.6.</span> <span class="nav-text">本地SQL检索</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate的多表查询"><span class="nav-number">16.</span> <span class="nav-text">Hibernate的多表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原生SQL多表查询"><span class="nav-number">16.1.</span> <span class="nav-text">原生SQL多表查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HQL连接查询"><span class="nav-number">16.2.</span> <span class="nav-text">HQL连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#种类"><span class="nav-number">16.2.1.</span> <span class="nav-text">种类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#迫切连接fetch"><span class="nav-number">16.2.2.</span> <span class="nav-text">迫切连接fetch</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate的抓取策略"><span class="nav-number">17.</span> <span class="nav-text">Hibernate的抓取策略</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#延迟加载（懒加载）"><span class="nav-number">17.1.</span> <span class="nav-text">延迟加载（懒加载）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#类级别的延迟加载"><span class="nav-number">17.1.1.</span> <span class="nav-text">类级别的延迟加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关联级别的延迟加载"><span class="nav-number">17.1.2.</span> <span class="nav-text">关联级别的延迟加载</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抓取策略"><span class="nav-number">17.2.</span> <span class="nav-text">抓取策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#批量抓取"><span class="nav-number">17.2.1.</span> <span class="nav-text">批量抓取</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JiachengLai</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

  <script type="text/javascript" src="/js/src/love.js"></script>
</body>
</html>
